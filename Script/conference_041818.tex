\documentclass[conference]{IEEEtran}
\IEEEoverridecommandlockouts
% The preceding line is only needed to identify funding in the first footnote. If that is unneeded, please comment it out.
\usepackage{cite}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{algorithmic}
\usepackage{graphicx}
\usepackage{textcomp}
\usepackage{xcolor}

% For fig
\usepackage{physics}
\usepackage{amsmath}
\usepackage{tikz}
\usepackage{mathdots}
\usepackage{yhmath}
\usepackage{cancel}
\usepackage{color}
\usepackage{siunitx}
\usepackage{array}
\usepackage{multirow}
\usepackage{amssymb}
\usepackage{gensymb}
\usepackage{tabularx}
\usepackage{booktabs}
\usepackage{threeparttable}
\usepackage{subfigure}
\usetikzlibrary{fadings}
\usetikzlibrary{patterns}
\usetikzlibrary{shadows.blur}
\usetikzlibrary{shapes}

\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}
\begin{document}

\title{LSTM based Beam Tracking for mmWave Vehicular Networks\\
}

\author{\IEEEauthorblockN{Chen Wang, XXX, XXX, XXX}
\IEEEauthorblockA{\textit{Beijing Key Laboratory of Network System Architecture and Convergence, Beijing University of Posts and Telecommunications} \\
Beijing, China \\
wangchen@bupt.edu.cn}
}

\maketitle

\begin{abstract}
The use of millimeter wave (mmWave) frequency bands for transmission can improve data transmission rate with the help of beamforming technology to overcome the high path and penetration losses.
However for vehicle, the high mobility of vehicle results in extremely frequent beam alignment and significant overhead.
In this paper, a long short-term memory (LSTM) based beam tracking scheme was proposed for reducing overhead brought by beam alignment in mmWave Vehicular Networks, by predicting beam angles at next time step through known beam angles at a certain number of consecutive time steps as features.
To train this network, a time series array antenna channel data was set up by statistical channel model using time series vehicle information generated from road traffic simulation software named ``Simulation of Urban MObility (SUMO)''.
Simulation results show that the proposed LSTM based scheme can reduce a significant overhead with an acceptable loss in spectral efficiency compared with exhaustive search scheme.
% Simulation results show that the proposed LSTM based scheme outpreforms Kalman filter based scheme, and can prevent frequent beam alignment to reduce overhead while ensuring acceptable signal to noise ratio (SNR).
\end{abstract}

\begin{IEEEkeywords}
beam tracking, mmWave vehicular networks, LSTM
\end{IEEEkeywords}

\section{Introduction}
% 毫米波依靠丰富的频谱资源，可以有效提高传输速率，是通信未来发展的重要技术之一 *。
MmWave is one of the important technology for the future development of communications \cite{Niu2015}, relies on abundant spectrum resources.
% 为了更好地应用的毫米波，需要克服毫米波高频导致的极高的路径和穿透损耗 *。
In order to apply mmWave better, the high path and penetration loss caused by high frequency of mmWave need to be overcome \cite{Zhao2013}.
% 得益于毫米波毫米级的波长，可能将阵列天线集成进终端，并使用阵列天线的波束赋形技术，将天线能量约束在指定方向，获取高增益 *。
Thanks to the short wavelength of mmWave, it is possible to integrate array antennas into small chip and use beamforming technique to constrained signal power in specified direction for high gain \cite{Heath2016}.
% 论文 * 提出了数字波束赋形技术，然而由于射频链的高价格和高能耗，给天线阵列中的每一根天线都配置射频链的成本是不可接受的 *。
% 目前较多的研究主要集中在基于量化相移器的单射频链模拟波束赋形 *，和使用较少射频链的混合波束赋形 * 折中方案上。

% 不同于传统全向天线，阵列天线的信道具有方向性 *，这意味着若想形成较高的波束增益，必须保证接收端和发送端的波束之间相互对准，否则波束对的失准将会带来严重的增益下降，降低通信性能。
Unlike conventional omni-directional antennas, array antennas are directional \cite{Giordani2019}, which means that if high antenna gain needs to be achieved, it is important to ensure that the beams generated by array antennas at the receiver and transmitter are aligned well with each other.
Otherwise the misalignment of the beam pairs will result in serious gain reduction, degrading communications performance.
% 研究 * 提出了一种分级码本的设计，本质是采用了二分查找的方式，在不同阶段使用不同宽度的波束进行波束扫描并获得最佳波束对，以此减少开支。
A hierarchical codebook design was proposed in \cite{Noh2017}, which essentially exploit binary search algorithm to reduce overhead by using different widths of beams at different stages to perform beam search.
% 然而，这种算法需要量化相移器具有较高的量化水平，并且有可能需要多个射频链来实现，这导致采用这种算法方案的成本极高。
However, this algorithm requires a high quantization level phase shifter and potentially multiple RF chains to implement, which results in high cost.
% 对此，* 提出了一种基于卡尔曼滤波器使用穷尽扫描进行波束追踪的方案，以减少系统的开支，然而穷尽扫描所需要的测量次数和协议开支会随着天线数的增加而增加。
In \cite{Zhang2016}, Zhang et al. proposed a Kalman filter based scheme for beam tracking using exhaustive search. However, the number of measurements and protocol overhead for exhaustive search required increases with the number of elements in antenna.
% * 在此基础上加以改进采用 EKF，并且只需要单次测量，更适用于在快速变换环境下的信道追踪。
On the other hand, \cite{Va2017} exploits extended Kalman filter and requires only a single measurement, making it more suitable for beam tracking in fast-changing environments.

% 相较于低速的用户终端，为高速车辆提供可靠的波束对准更具挑战性，因为车辆较高的速度将会导致车辆更快驶出波束的覆盖范围。
Providing reliable beam alignment for high speed vehicles is more challenging than for low speed terminals, due to vehicles move out of the beam coverage faster. 
%为了保证车辆始终被较高增益的波束覆盖，需要进行高频率的对准，而高频的波束会进一步加大系统的开支，尤其是当采用高分辨率码本的时候。
To ensure that the vehicles are always covered by high gain beams, high frequency beam alignment is required, and it will further increase system overhead, especially when high resolution code books are used.
% 幸运的是，由于毫米波信道的稀疏性 *，且毫米波信道的 AoA、AoD 与收发端位置的具有一定的相关性 *，在 LOS 信号下沿固定道路行驶的车辆的 AoA 和 AoD 应该能被很好的预测出来。
Fortunately, due to the sparsity of mmWave channel \cite{Lee2014} and the correlation between the angle of arrival (AoA) and angle of departure (AoD) of a millimeter-wave channel and the location of the receiver and transmitter \cite{Aviles2016}, the beam angles of a vehicle traveling along a road under LOS condition can be well predicted.

% 本文提出了一种基于 LSTM 网络的波束追踪方法，使用 LSTM 网络，通过对历史车辆穷尽扫描所获得的历史信道信息进行学习，根据当前车辆在一定时间步的信道信息，预测在下一时刻的 AoA 和 AoD，以达到减少系统开支的效果。
In this paper, a LSTM based beam tracking scheme is proposed. By using LSTM network to learn the historical channel state information (CSI) which was obtained from exhaustive beam search, AoA and AoD of current channel between vehicle and BS can be predicted to reduce system overhead.
% 同时，为了获取信道数据用以训练神经网络，交通流仿真软件 SUMO 被用来生成时序车辆信息，结合统计信道模型与生成的时序车辆信息，生成了时序的信道信息。
Meanwhile, a road traffic simulation software is use to generate time seires vehicle information (e.g. position, speed, etc.) to set up time seires CSI with a statistical channel model for training the network.
%% 此外，提出了快速中断恢复算法，在追踪失效后能够减少波束扫描的次数，尽快恢复连接。
% 相比较于 *，本论文有以下几点不同：1）采用了更加完善的信道模型；2）同时预测 AoA 与 AoD；3）中断判断根据接收端的 SNR 而非角度差进行判断；4）在一个追踪周期中平均需要更少的波束测量。此外，与 * 相比使用了更实际的基于量化相移器的波束码本进行波束扫描。
Compared with prior work, this paper differs in the following ways: 1) More realistic channel model; 2) Simultaneous prediction of AoA and AoD; 3) The outage judgment is based on the SNR of the receiver instead of the angle difference; 4) Fewer beam measurements required on average in a tracking cycle. 5) In addition, beam search is performed more realistic by using a quantized phase shifter based beamforming.

% 内容安排

% 符号使用
The following notation will be used in this paper.
% 矩阵，向量，标量
Matrices, vectors and scalars are denoted by bold uppercase letters (e.g. $\mathbf{A}$), bold lowercase letters (e.g. $\mathbf{a}$) and lowercase letters (e.g. $a$), respectively.
% 转置，共轭转置
$(\cdot)^{T}$ denote transpose and  $(\cdot)^H$ denote conjugate transpose (Hermitian).
% 矩阵指定行、列、元素
$[\mathbf{A}]_{m,:}$, $[\mathbf{A}]_{:,n}$ and $[\mathbf{A}_{m,n}]$ denote the $m$th row, $n$th column and the $m$th row $n$th column entry of $\mathbf{A}$, respectively.
% 向量指定元素
$[\mathbf{a}]_n$ denote the $n$th entry of $\mathbf{a}$.
% 2 范数
Besides, $\Vert{\cdot}\Vert_2$ denote $\ell_2$-norm of a vector.
% 复数、实数集合
$\mathbb{C}$ denote the set of complex number. % and $\mathbb{R}$ denote the set of real number.
% 复高斯、包络高斯、指数分布
Gaussian, complex Gaussian, wrapped Gaussian and exponential distribution are denoted by $\mathcal{N}$, $\mathcal{CN}$, $\mathcal{WN}$ and $\mathcal{E}$, respectively.

\section{System Model}\label{SM}

% 场景和天线数
A mmWave vehicular networks scenario including a vehicle with $M_r$ antenna elements as receiver and a base station (BS) with $M_t$ antenna elements as transmitter are considered. 
% 天线结构、阵元间距、赋形技术
Both of them equips with uniform linear array (ULA) of half wave interval antenna as shown in Fig.~\ref{geo}, and adopted analog beamforming used quantized phase shifter which connect with single analog radio frequency (RF) chain.
% 阵列响应矢量
The array response vector of a uniform linear array with $M$ half wave interval antenna elements is given by:
\begin{equation}
    \mathbf{a}( M,\varphi ) =\frac{1}{\sqrt{M}}\left[ 1,e^{j\pi cos( \varphi )} ,...,e^{j\pi ( M-1) cos( \varphi )}\right]^{T}
    \label{arv}
\end{equation}
where $\varphi$ is the arrival angle of the signal. When AoA of the vehicle is $\phi$ and AoD of the BS is $\theta$, the array response vectors of both are $\mathbf{a}_{r}( \phi ) =\mathbf{a}( M_{r} ,\phi )$ and $\mathbf{a}_{t}( \theta ) =\mathbf{a}( M_{t} ,\theta )$, respectively.

% 信道模型
The statistical 28 GHz mmWave channel model in \cite{Akdeniz2014} was used, which is modeled by real experimental data collected in New York City.
The narrowband time-varying $L$ subpaths channel matrix between the vehicle and BS at $n$th time step is $\mathbf{H}_{n} \in \mathbb{C}^{M_{r} \times M_{t}}$, which is given as:
\begin{equation}
    \mathbf{H}_{n} =\frac{1}{\sqrt{L}} \sum\limits ^{L}_{l=1} g_{ln}\mathbf{a}_{r}( \phi _{ln})\mathbf{a}^{H}_{t}( \theta _{ln})
    \label{cm}
\end{equation}
where $g_{ln} \in \mathbb{C}$ is complex small-scale fading gain on subpath $l$ at $n$th time step, $\phi_{ln}$ is AoA of the $l$th subpath signal received by the vehicle at $n$th time step, and $\theta_{ln}$ is AoD of the $l$th subpath signal transmitted by the BS at $n$th time step. 
$\phi_{ln} = \phi_n + \Delta \phi_{ln}$ and $\theta _{ln} =\theta _{n} +\Delta \theta _{ln}$, where $\phi_{n}$ and $\theta_{n}$ is the AoA and AoD of the cluster center at $n$th time step, $\Delta \phi _{ln} \sim \mathcal{WN}( \delta ^{2}_{rn})$, $\Delta \theta _{ln} \sim \mathcal{WN}( \delta ^{2}_{tn})$, $\delta_{tn} \sim \mathcal{E}(\lambda_t)$ and $\delta_{rn} \sim \mathcal{E}(\lambda_r)$.
The complex small-scale fading gain is given by:
\begin{equation}
    g_{ln} =\overline{g}_{ln} e^{j2\pi t_{n} f_{Dn,max} cos( \omega _{ln})}, \overline{g}_{ln} \sim \mathcal{CN}\left( 0, 10^{-0.1PL_n}\right)
    \label{ssfg}
\end{equation}
where $t_{n}$ is the signal transmission time at $n$th time step, $f_{Dn,max} ={v_{n}}/{\lambda _{c}}$ is maximum doppler shift at $n$th time step, $v_{n}$ is the speed of vehicle at $n$th time step, $\lambda _{c}$ is the carrier wavelength, $\omega _{ln} = \phi_{ln} - \pi / 2$ is the AoA of subpath $l$ relative to the direction of vehicle at $n$th time step, and $PL_n$ is omnidirectional path loss at $n$th time step, which is defined as:
\begin{equation}
    PL_n = 61.4 + 20 \log(d_n) + \xi~[dB]
    \label{pl}
\end{equation}
where $d_n$ is distance between the vehicle and BS at $n$th time step, and $\xi \sim \mathcal{N}(0, \sigma_p^2)$.
Note that only the case of single cluster under line-of-sight (LOS) condition is considered in this paper.
In addition, the cluster angle depends on the geometric position of the vehicle and base station.

% 接收信号
For a transmitted signal $x_n$ ($|x_n|=1$) from the BS, received signal $y_n$ in the vehicle at $n$th time step is:
\begin{equation}
    y_n = \mathbf{w}^H_n \mathbf{H}_n \mathbf{f}_n x_n + \mathbf{w}^H_n \mathbf{v}_n
    \label{rs}
\end{equation}
where $\mathbf{w}_n$ and $\mathbf{f}_n$ are combining vector and beamforming vector at $n$th time step, respectively. $\mathbf{v}_n$ is Gaussian noise at time step $n$ and $\mathbf{v}_n \sim \mathcal{CN}(0, \sigma^2_v \mathbf{I}_{M_r})$. 

\begin{figure}[htbp]
    \centerline{\input{geo}}
    \caption{Channel geometry}
    \label{geo}
\end{figure}

\section{LSTM based Beam Tracking Solution}

% 网络
\subsection{The LSTM Network}

% 问题定义
The purpose of beam tracking is to obtain beam angles ($\phi_{ln}$ and $\theta_{ln}$) with as few beam measurements as possible for reducing overhead brought by beam search.
Since the vehicle must travel in a particular direction on the road and the mmWave beams are correlated with the position of vehicles, the problem of obtaining beam angles can be formulated as a time series regression problem after the historical CSI of vehicles is collected.

% LSTM 方案
An artificial neural network named LSTM network was used to solve this regression problem.
It has been implemented successfully in several fields such as machine translation, image captioning, speech recognition, and even stock prices prediction in economy.
As one of the recurrent neural networks (RNNs), LSTM are generally considered to be more robust to long time series than simpler vanilla RNN implementations \cite{Hochreiter1997}.
It is powerful for handling time series data, beacase relying on three gates which are forget, input and output gate composed of neural networks (NNs) in LSTM cells, it can learn long-term relations between features.

\begin{figure}[htbp]
    \centerline{\input{lstm}}
    \caption{Structure of network}
    \label{lstm}
\end{figure}

% 结构
Fig.~\ref{lstm} shows the structure of the network, which is a sequential model comprises LSTM layer with 50 hidden units, a dropout layer with 0.2 probability, a LSTM layer with 50 hidden units, a dropout layer with 0.2 probability and a fully connected layer with 2 nodes.
The output of the first LSTM layer is a sequence of length $n_{LSTM}$, which is used as the input of the second LSTM layer.
And two dropout layers are set to prevent overfitting. 

% 损失函数？
\subsection{Loss Function}

Mean Square Error (MSE) is the most commonly used regression loss function for quantifying the error of prediction.
In \cite{Burghal2019}, considering the problem of angle ambiguity due to the periodicity of the beam angle results in unnecessary loss for large difference of beam angle when used MSE, D. Burghal et al. proposed to use a shifted cosine function as the loss function. 
However, when using this formula as a loss function, the training progress may be unstable due to the multiple global minima, and the responses may not converge in a reasonable interval.

In addition, another problem is that the codewords whose beam angle near $0$ or $\pi$ have close gains at two different angles, resulting in unnecessary loss in some cases.
For instance, in the case of the codeword whose beam angle is $\pi$, there are same gains at $0$ and $\pi$. 
The loss should be small, even zero, if estimated angle is $0$ and predicted angle is $\pi$, although the absolute difference of them is $\pi$.
A straightforward idea is taking the negative of the dot product of the array response vector of estimated angle and predicted angle plus a positive constant as the loss function.
Calculating this loss, however, requires array response vectors of estimated angle and predicted angle at the corresponding time step, which will increase the computational cost when training network.
On the other hand, considering this function contains complex numbers, it will be difficlut to perform backpropagation (BP).

Hence, to avoid the problem of angle ambiguity and close gains, the AoAs and AoDs are limited in $(0, \pi]$ by simple conversion before training.
Considering complexity of computation and training performance, a modified MSE is used as loss function, which is given as:
\begin{equation}
    Loss = \frac{1}{N} \sum_{i=1}^{N}\left[(\phi^{p}_{i} - \phi^{e}_{i})^2 + (\theta^{p}_{i} - \theta^{e}_{i})^2\right]
    \label{lf}
\end{equation}
where $N$ is the number of training samples, $\phi ^{e}_{i}$, $\theta ^{e}_{i}$, $\phi ^{p}_{i}$, $\theta ^{p}_{i}$, are the estimated AoA, estimated AoD, predicted AoA, and predicted AoD, respectively, for training sample $i$.

% 预测过程
\subsection{Procedure of Beam Tracking}

Before the beam tracking, the BS demands to collect historical CSI, which are estimated by the vehicles using exhaustive beam search, for training the LSTM network.
For time step $k$, the network takes the AoAs and AoDs from time step $(k - n_{LSTM})$ to $(k - 1)$ as features and the AoA and AoD at time step $k$ as responses.
The dataset is consisted of time series AoAs and AoDs of the vehicles from initial access to disconnection.

After the LSTM network has been trained, at the beginning of a round of beam tracking, a vehicle takes $n_{LSTM}$ consecutive exhaustive beam search to obtain initial estimated AoAs and AoDs, and the network will take the estimated AoAs and AoDs to predict AoA and AoD at next time step. 
Then, the predicted AoA and AoD at $k$th time steps will be used to compose new feature which from $(k - n_{LSTM} + 1)$th to $k$th time steps to predict the AoA and AoD at $(k + 1)$ time step.
For every time step, SNR under current predicted AoA and AoD will be calculated and compares with a threshold ${SNR}_T$.
The network will repeat to use predicted result to compose new features to predict AoA and AoD, when the calculated SNR is greater than ${SNR}_T$.
Otherwise, a new round of estimation and prediction will be repeated.

It makes more sense to use the SNR of received signal rather than the absolute difference of the angles as a threshold, because there is no way to obtain an accurate beam angle for comparing with the threshold until it is accurately measured or predicted.

%% 快速中断恢复算法？
%\subsection{Fast Outage Recovery}

\section{Data Generation}

% 信道矩阵
\subsection{Channel Matrix}
% 场景介绍
A road traffic simulation software named ``SUMO'' was used to generate time series information of the vehicle in the scenario mentioned in Section \ref{SM}, which including a BS and a vehicle driving on curve road as shown in Fig.~\ref{scene}.
The vehicle departs from $(0, 100)$ at first time step, and arrives $(100, 0)$ at final time step.
Note that the speed of vehicle is non-linear and depends on the road conditions and behavior of the dirver which defined by SUMO.

% 几何信息
The generated vehicle time series information is composed of position, $v_n$ and directional angle $\beta_n$ of the vehicle at each time step.
For $n$th time step, the position of vehicle is given by $(x_{rn}, y_{rn})$, $v_n$ is used to determine maximum doppler shift in \eqref{ssfg}, and $\beta_n$ is used to determine $\phi_{ln}$ and $\omega_{ln}$.

Once the position of the vehicle and the BS are obtained, $\theta_n$ and $\phi_n$ can be calculated by simple geometric methods as following:
\begin{equation}
    \begin{cases}
    \theta _{n} =\arg( \Gamma _{xn} +j\Gamma _{yn})\\
    \phi _{n} =\arg( \Gamma _{xn} +j\Gamma _{yn}) -\beta _{n}
    \end{cases}
    \label{ba}
\end{equation}
where $\Gamma _{xn} =x_{rn} -x_{t}$, $\Gamma _{yn} =y_{rn} -y_{t} $, $(x_{t}, y_{t})$ are coordinates of the BS, $\beta _{n}$ is directional angle of the vehicle. 
Furthermore, the signal transmission time $t_n = d_n / c$ can be calculated, where the distance between the BS and the vehicle is $d_n = \sqrt{\Gamma_{xn}^2 + \Gamma_{yn}^2}$, and $c$ is light speed.
Now the channel matrix at each time step can be obtained from \eqref{cm}, \eqref{ssfg}, \eqref{pl} and \eqref{ba}.

% 波束角度
\subsection{Beam Search}

% 管理方式
In this paper, Downlink (DL) configuration scheme is considered for beam management.
The beam management procedure is as follows. The reference signals are sent to the vehicle from the BS, the vehicle measures and determines the optimal beam for communication, then transmits beam reporting back to the BS.

\begin{figure}[!tbp]
    \centerline{\input{scene}}
    \caption{Scene of mmWave vehicular networks for data generation}
    \label{scene}
\end{figure}

% 码本设计
AoAs and AoDs measured from exhaustive beam search scheme is used to train the network, rather than using the generated CSI directly.
Although AoAs and AoDs are in range $[0, 2\pi]$, only the angles in range $[0,\pi]$ are considered, since the cosine function of the angles is symmetric around $\pi$.
To reduce the overhead of beamforming, a discrete resolution $b$-bit codebook is adopted to perform beam search, where $b$ is the number of bits for quantized phase shifters.
For a $b$-bit codebook, it is consisted of $2^b$ beam patterns.
In this paper, $b$ is assumed to be $2log_2 M$ for a $M$-element antenna terminal.
For a terminal with $M$-element antenna, the candidate beam angles vector $\mathbf{b}_M$ is given by:
\begin{equation}
    \mathbf{b}_M = \left[\frac{1}{2M}\pi, \frac{2}{2M}\pi, ..., \pi\right]
\end{equation}
So, there are $2M_r$ beam patterns for the vehicle, and $2M_t$ beam patterns for the BS.
Note that another codebook which achieves uniform maximum gain in all direction is not used for this solution, beacause its low spatial resolution near $0$ and $\pi$ resulting in network underfitting.
The beam codebooks of the vehicle and the BS are:
\begin{gather}
    \begin{aligned}
        \mathbf{W} =&\left[\mathbf{a}_{r}([\mathbf{b}_{M_r}]_1) ,\mathbf{a}_{r}\left([\mathbf{b}_{M_r}]_2 \right) ,...,\mathbf{a}_{r}\left([\mathbf{b}_{M_r}]_{2M_r} \right)\right] \\
        \mathbf{F} =&\left[\mathbf{a}_{t}([\mathbf{b}_{M_t}]_1) ,\mathbf{a}_{t}\left([\mathbf{b}_{M_t}]_2 \right) ,...,\mathbf{a}_{t}\left([\mathbf{b}_{M_t}]_{2M_t} \right)\right]
    \end{aligned}
\end{gather}
where $\mathbf{W} \in \mathbb{C}^{M_{r} \times 2M_{r}}$ is the codebook matrix of vehicle, and $\mathbf{F} \in \mathbb{C}^{M_{t} \times 2M_{t}}$ is the codebook matrix of BS. Each column of the codebook matrix represents a beam pattern, each entry in the column is phase rotation for corresponding antenna element to generate directional beam.

% 观察信号
Assume $x_n = 1$ is sent as refernece signal, the observation matrix comprises all measurement of exhaustive search now can be given by:
\begin{equation}
    \mathbf{Y}_{n} =\mathbf{W}^{H}\mathbf{H}_{n}\mathbf{F} +\mathbf{V}_{n}
\end{equation}
where $\mathbf{V}_n \in \mathbb{C}^{2M_r \times 2M_t}$ is Guassian noise matrix composed of independent identically distribution (i.i.d.) elements, which are the noise part of \eqref{rs}. $\mathbf{Y}_n \in \mathbb{C}^{2M_r \times 2M_t}$, $[\mathbf{Y}_n]_{i,j}$ is the received signal of using $[\mathbf{W}]_{:,i}$ as combining vector and $[\mathbf{F}]_{:,j}$ as beamforming vector.

% 最优波束
For each time step, both of the vehicle and the BS use their beam codebook to perform exhaustive beam search to find the optimal beam pair.
The indexs of optimal beam pair can be obtained by solving a optimization problems as following:
\begin{equation}
    \begin{aligned}
        ( i_{n}^* ,j_{n}^*) =~&\underset{i_{n} ,j_{n}}{\operatorname{argmax}}\Vert [\mathbf{Y}_{n}]_{i_{n} ,j_{n}}\Vert _{2} \\
        s.t.~&i_{n} \in [ 1,2M_{r}], \\
        &j_{n} \in [ 1,2M_{t}]
    \end{aligned}
\end{equation}
A simple nested loop algorithm can be expolited to solve this problem. Then, at $n$th time step, the optimal combining vector $\mathbf{w}^{*}_{n}$ and the optimal beamforming vector $\mathbf{f}^{*}_{n}$ are $\mathbf{w}^{*}_{n}=[\mathbf{W}]_{:,i_{n}^*}$ and $\mathbf{f}^{*}_{n}=[\mathbf{F}]_{:,j_{n}^*}$, respectively. And the estimated AoA $\phi ^{e}_{n}$ and AoD $\theta ^{e}_{n}$ used to training network are given by:
\begin{equation}
    \begin{cases}
        \phi ^{e}_{n} = \frac{i_{n}^* \pi}{2M_{r}}\\
        \theta ^{e}_{n} = \frac{j_{n}^* \pi}{2M_{t}}
    \end{cases}
\end{equation}
The advantage of training with radian instead of the codeword indices is that it allows the proposed beam tracking solution to be generalized under terminals with different antenna configuration and beamforming techniques, without additional computation and transimtted data.

% 数据平滑
Note that due to the limited resolution of the beam codebook and the noise received at the vehicle, there will be some errors for the channel estimation, which is reflected in fluctuations in the estimated time series AoAs and AoDs.
To reduce the fluctuations, a first order Savitzky-Golay filter \cite{Savitzky1964} with frame length 11 was used to smooth the estimated AoAs and AoDs for training the LSTM network better.

%% 角度范围
%\subsection{Range of AoAs and AoDs}

%After getting the AoAs and AoDs for all time step, we use a time windows of 1 second to get the range of them for a total of 11 time steps, including the current time step and 10 future time steps.

\section{Simulation Results}

In this section, the performances of proposed LSTM based beam tracking solution is presented by analyzing the SNR of received signal, number of measurements and outage probability.
The outage probability for a simulation is given by:
\begin{equation}
    P_{o} =\frac{\sum ^{N}_{i=1}\mathbf{I}( {SNR}_{i} \leqslant {SNR}_{T})}{N}
\end{equation}
where ${SNR}_i$ is the SNR of received signal for $i$th sample and $\mathbf{I}$ is an indicator function.

In this paper, the sample rate of series channel data is $20$ Hz (20 samples per second) and there are total $613$ samples for training and $401$ samples for testing. 
Table \ref{t_SP} shows the common simulation parameters.
For each simulation, parameters default to the values in Table \ref{t_SP}, except for those mentioned specifically.

% 仿真参数
\begin{table}[!t]
    \renewcommand{\arraystretch}{1.3}
    \caption{Simulation Parameters}
    \label{t_SP}
    \centering
    \begin{tabular}{l c}
        \hline
        \bfseries Parameters & \bfseries Values\\
        \hline
        Carrier frequency $f_{c}$ & $28 \times 10^9$ Hz\\
        Coordinates of BS $(x_t, y_t)$ & $(80, 80)$\\
        Number of antenna elements for BS $M_t$ & $16$\\
        Number of antenna elements for Vehicle $M_r$ & $4$\\
        Number of subpaths $L$ & $20$\\
        Expectation of BS rms angular spread $\lambda_t$ & $10.2 \degree$\\
        Expectation of Vehicle rms angular spread $\lambda_r$ & $15.5 \degree$\\
        Path loss standard deviation $\sigma_p$ & $5.8$ dB\\
        Noise variance of received signal $\sigma_v^2$ & $-140$ dBW\\
        Threshold of SNR ${SNR}_T$ & $5$ dB\\
        Lookback of LSTM $n_{LSTM}$ & $5$\\
        Optimizer of LSTM & Adam\\
        Training Epochs & 400\\
        Batch size & Training data size\\
        Learning rate & 0.05\\
        Normalization & None\\
        \hline
    \end{tabular}
\end{table}
    
% 收敛性能？
\begin{figure}[!b]
    \centering
    \subfigure[RMSE of the LSTM Network]{
        \includegraphics[scale=0.65]{results_rmse}
        \label{results_rmse}
        }
    \subfigure[Loss of the LSTM Network]{
        \includegraphics[scale=0.65]{results_loss}
        \label{results_loss}
    }
    \caption{Convergence of the LSTM network}
    \label{results_convergence}
\end{figure}

Fig.~\ref{results_convergence} demonstrates the convergence of the LSTM network.
The RMSE of the LSTM network is shown in Fig.~\ref{results_rmse}.
It is observed that the RMSE rapidly converges to about $0.4$ around $50$th epoch, and finally converges to about $0.2$ after $400$ epochs.
And the loss of the LSTM network is shown in Fig.~\ref{results_loss}.
It shows that the loss decreases sharply around $20$ epochs, and converges to a small value about $0.01$ after $400$ epochs.
% 16 * 4 天线，不同噪声方差下的平均 SNR，中断次数和观测次数
% 随着噪声方差增大，平均 SNR 降低，中断次数和观测次数增多。
\begin{figure}[!t]
    \centering
    \includegraphics[scale=0.59]{results_noise}
    \caption{Average SNR and outages probability versus $\sigma_v^2$}
    \label{results_noise}
\end{figure}

Fig.~\ref{results_noise} shows the performances of schemes versus noise variance of received signal.
The vehicle using exhaustive search scheme uses exhaustive search method to find the optimal beam angles at each time step.
It illustrates that for both exhaustive search and LSTM based scheme, the average SNR of received signal is decreasing and the probability of outages is increasing with the increasing of $\sigma_v^2$.
The difference in performance between the LSTM based scheme and the exhaustive search scheme is small, up to about $6$ dB.
When $\sigma_v^2=-140$ dBW, the average SNR of received signal in exhaustive search is $54.67$ dB and in LSTM based scheme is $52.32$ dB, there is only $2.35$ dB loss in SNR, and about $4.3$\% loss in spectral efficiency.

Since the SNR performance of exhaustive search is considered to be the best, there is a high probability that if there are outages when using exhaustive search, there will also be outages when using other schemes at the same time.
Fig.~\ref{results_noise} shows that there is not any outages when the noise variance of received signal is lower than $-140$ dBW.
Therefore, the default noise variance of received signal is defined as $-140$ dBW for following simulations to ensure that there are not any outages when using exhaustive search to acquire AoAs and AoDs in this scenario.

\begin{table}[!b]
    \renewcommand{\arraystretch}{1.3}
    \centering
    \begin{threeparttable}
    \caption{\label{t_NM}Comparisons of the Number of Measurements}
        \begin{tabular}{c c c}
            \hline
            \bfseries Schemes & \bfseries Complexity & \bfseries Number of Measurements\\
            \hline
            LSTM based & $N_s + N_f M_t M_r$\tnote{1} & $2240$\\
            Exhaustive search & $N M_t M_r$ & $39552$\\
            \hline
        \end{tabular}
        \begin{tablenotes}
            \item[1] $N_s$ is the number of successful prediction samples and $N_f = N - N_s$.
        \end{tablenotes}
    \end{threeparttable}
\end{table}

Table \ref{t_NM} shows the comparison of the number of measurements in differenct schemes.
Compared with the exhaustive search scheme, proposed LSTM based scheme can reduce about 94.3\% measurement overhead.
Considering the significant reduction in measurement overhead, the 4.3\% loss of spectral efficiency in Fig.~\ref{results_noise} seems to be acceptable.
Note that the proposed LSTM based scheme obtain initial beam angles for prediction by exhaustive search method in this paper, and it is obvious that the measurement overhead can be further reduced by utilizing a less complex beam search method (e.g. hierarchical method).

% 不同规格天线，10^(-14) 噪声方差的比较
% 少天线效果好，中天线效果最佳，多天线效果回落。

\begin{figure}[!t]
    \centering
    \includegraphics[scale=0.59]{results_antenna}
    \caption{Average SNR and outages probability versus $M_t \times M_r$}
    \label{results_antenna}
\end{figure}

Fig.~\ref{results_antenna} shows the performances of schemes versus antenna configuration $M_t \times M_r$.
It is illustrates that the performances of LSTM based scheme is decreasing with the increasing of antennas scale.
The reason is the beamwidths of both are so small that reducing the tolerance for prediction error and making it difficlut for LSTM based scheme to accurately align with each other.
It is observed that there are fluctuations in both SNR and outages probability, due to the randomness of the channel which is caused by the statistical characteristics of the channel and the vehicle movement.

\section{Conclusions}

This paper studies the problem of beam tracking in mmWave vehicular network, and a LSTM based beam tracking scheme is proposed to reduce the beam alignment overhead in a common vehicular scenario.
In order to train and evaluate the proposed scheme, a time series array antenna channel data was set up by statistical channel model using time series vehicle information generated from SUMO.
Simulation results show that the proposed LSTM based scheme can reduce significant measurement overhead compared with the exhaustive search scheme, while ensuring an acceptable loss in SNR.

\section*{Acknowledgment}

This work was supported by ...

\bibliographystyle{IEEEtran}
\bibliography{references}

\end{document}