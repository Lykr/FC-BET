\documentclass[conference]{IEEEtran}
\IEEEoverridecommandlockouts
% The preceding line is only needed to identify funding in the first footnote. If that is unneeded, please comment it out.
\usepackage{cite}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{algorithmic}
\usepackage{graphicx}
\usepackage{textcomp}
\usepackage{xcolor}

% For fig
\usepackage{physics}
\usepackage{amsmath}
\usepackage{tikz}
\usepackage{mathdots}
\usepackage{yhmath}
\usepackage{cancel}
\usepackage{color}
\usepackage{siunitx}
\usepackage{array}
\usepackage{multirow}
\usepackage{amssymb}
\usepackage{gensymb}
\usepackage{tabularx}
\usepackage{booktabs}
\usepackage{threeparttable}
\usepackage{subfigure}
\usetikzlibrary{fadings}
\usetikzlibrary{patterns}
\usetikzlibrary{shadows.blur}
\usetikzlibrary{shapes}

\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}
\begin{document}

\title{LSTM-Based Beam Tracking for mmWave Vehicular Networks}

\author{
    \IEEEauthorblockN{Chen Wang, XXX, XXX, XXX}
    \IEEEauthorblockA{
        \textit{Beijing Key Laboratory of Network System Architecture and Convergence} \\
        \textit{Beijing University of Posts and Telecommunications} \\
        \textit{Beijing Laboratory of Advanced Information Networks} \\
        Beijing, China \\
        wangchen@bupt.edu.cn}
}

\maketitle

\begin{abstract}
The use of millimeter wave (mmWave) frequency bands can improve data transmission rate with the help of beamforming technique to overcome the high path and penetration losses.
However, utilizing mmWave technology in vehicular networks is challenging, as the high mobility of vehicles results in frequent beam alignment and significant overhead.
In this paper, a long short-term memory (LSTM)-based beam tracking scheme is proposed for reducing overhead caused by beam alignment in mmWave Vehicular Networks, by predicting beam angles at next time step through known beam angles at a certain number of consecutive time steps as features.
To train this network, a time series channel data is set up by statistical channel model using time series vehicle information generated from road traffic simulation software named ``Simulation of Urban MObility (SUMO)''.
Simulation results have verified the proposed LSTM-based scheme can reduce a significant overhead with an acceptable loss in spectral efficiency compared with exhaustive search scheme.
% Simulation results show that the proposed LSTM-based scheme outpreforms Kalman filter based scheme, and can prevent frequent beam alignment to reduce overhead while ensuring acceptable signal to noise ratio (SNR).
\end{abstract}

\begin{IEEEkeywords}
beam tracking, mmWave vehicular networks, LSTM
\end{IEEEkeywords}

\section{Introduction}
% 毫米波依靠丰富的频谱资源，可以有效提高传输速率，是通信未来发展的重要技术之一 *。
MmWave is one of the important technologies for the future development of communications \cite{Niu2015}, relying on abundant spectrum resources.
% 为了更好地应用的毫米波，需要克服毫米波高频导致的极高的路径和穿透损耗 *。
In order to use mmWave to increase transmission rate effectively, the high path and penetration loss caused by high frequency of mmWave need to be overcome \cite{Zhao2013}. 
% 得益于毫米波毫米级的波长，可能将阵列天线集成进终端，并使用阵列天线的波束赋形技术，将天线能量约束在指定方向，获取高增益 *。
Fortunately, it is possible to integrate mmWave phased array antennas into small chip with the help of short wavelength of mmWave, and use beamforming technique to deliver signal power in specified direction for high gain \cite{Heath2016}.
% 目前波束赋形技术主要包括，模拟波束赋形，数字波束赋形和混合波束赋形，考虑到数字波束赋形技术较大的硬件和计算开销，目前较多的研究主要集中在模拟波束赋形，和混合波束赋形方案上 *。
Several beamforming techniques are most commonly used for beamforming, i.e. analog, digital and hybrid beamforming.
Considering the digital beamforming is prohibitively complex and costly, it has not been largely adopted by both indoor and outdoor mmWave communications, and most of the researches focused on analog and hybrid beamforming \cite{MercySheeba2020}.
% Considering the digital beamforming is prohibitively complex and costly due to the requirement of a dedicated radio frequency (RF) chain for each antenna element and higher dynamic range for analog front end RF circuitry, it has not been largely adopted by both indoor and outdoor mmWave communications \cite{MercySheeba2020}.

% 不同于传统全向天线，阵列天线的信道具有方向性 *，这意味着若想形成较高的波束增益，必须保证接收端和发送端的波束之间相互对准，否则波束对的失准将会带来严重的增益下降，降低通信性能。
Unlike conventional omnidirectional antennas, mmWave array antennas are directional \cite{Giordani2019}, which means that if high antenna gain needs to be achieved, it is important to ensure that the beams generated by the receiver and transmitter are aligned well with each other.
Otherwise, misalignment of the beam pairs will result in reduction in gain and degrading performance.
% 研究 * 提出了一种分级码本的设计，本质是采用了二分查找的方式，在不同阶段使用不同宽度的波束进行波束扫描并获得最佳波束对，以此减少开支。然而，这种算法需要量化相移器具有较高的量化水平，并且有可能需要多个射频链来实现，这导致采用这种算法方案的成本极高。
A hierarchical codebook design was proposed in \cite{Noh2017}, which essentially exploits binary search algorithm to reduce overhead by using different beam widths at different stages to perform beam search.
This algorithm requires a high quantization level phase shifter and potentially multiple RF chains to implement, which leads to high cost.
% 对此，* 提出了一种基于卡尔曼滤波器使用穷尽扫描进行波束追踪的方案，以减少系统的开支，然而穷尽扫描所需要的测量次数和协议开支会随着天线数的增加而增加。
In \cite{Zhang2016}, Zhang et al. proposed a Kalman filter based scheme for beam tracking using exhaustive search, whose measurement and protocol overheads increase with the number of elements in antenna.
% * 在此基础上加以改进采用 EKF，并且只需要单次测量，更适用于在快速变换环境下的信道追踪。
Based on prior works, \cite{Va2017} exploits extended Kalman filter and requires only a single measurement, making it more suitable for beam tracking in fast-changing environments.

% 相较于低速的用户终端，为高速车辆提供可靠的波束对准更具挑战性，因为车辆较高的速度将会导致车辆更快驶出波束的覆盖范围。
Providing reliable beam alignment in mmWave vehicular networks is more challenging, due to vehicles move out of the beam coverage area faster. 
%为了保证车辆始终被较高增益的波束覆盖，需要进行高频率的对准，而高频的波束会进一步加大系统的开支，尤其是当采用高分辨率码本的时候。
Frequent beam alignment is required to ensure that the vehicles are always covered by high gain beams, and it will further increase system overhead, especially when high resolution codebooks are used.
% 幸运的是，由于毫米波信道的稀疏性 *，且毫米波信道的 AoA、AoD 与收发端位置的具有一定的相关性 *，在 LOS 信号下沿固定道路行驶的车辆的 AoA 和 AoD 应该能被很好的预测出来。
Fortunately, due to the sparsity of mmWave channel \cite{Lee2014} and the correlation between the angles of arrival (AoAs) and departure (AoDs) of a mmWave channel and the positions of the receiver and transmitter \cite{Aviles2016}, the beam angles of a vehicle traveling along a road under LOS condition can be well predicted.
% 机器学习方法
Wang et al. proposed a situational awareness-aided beam training solution using machine learning in mmWave Vehicle to Infrastructure (V2I) communication, which is dependent on availability of accurate localization of vehicles \cite{Wang2019}. 
In practice, the inaccurate or incomplete situational awareness may be introduced by localization error, limited location updating frequencies and data transmission rate of vehicles, resulting in beam misalignment.

% 本文提出了一种基于 LSTM 网络的波束追踪方法，使用 LSTM 网络，通过对历史车辆穷尽扫描所获得的历史信道信息进行学习，根据当前车辆在一定时间步的信道信息，预测在下一时刻的 AoA 和 AoD，以达到减少系统开支的效果。
In this paper, a LSTM-based beam tracking scheme is proposed.
By using LSTM network to leverage the historical beam angles which were obtained from exhaustive beam search performed by analog beamforming based on quantized phase shifter, AoA and AoD of current channel between vehicle and BS can be predicted simultaneously to reduce measurement overhead.
% 仿真过程
In each round of tracking, the predicted beam angles will be used to select beamforming codeword for transmission and compose new feature, until the signal-to-noise ratio (SNR) of received signal less than or equal to a threshold.
% 此外，为了获取信道数据用以训练神经网络，交通流仿真软件 SUMO 被用来生成时序车辆信息，结合统计信道模型与生成的时序车辆信息，生成了时序的信道信息。
In addition, a road traffic simulation software is used to generate time series vehicle information (e.g. position, speed, direction, etc.) to set up time series channel data with a statistical channel model which is modeled by real experimental data for training and evaluating the network.
% Compared with prior works, this paper differs in the following ways: 1) More realistic channel model; 2) Simultaneous prediction of AoA and AoD; 3) Outage judgment is based on the SNR of receiver instead of the angle difference; 4) Fewer beam measurements required on average in a tracking round. 5) In addition, beam search is performed more realistic by using a quantized phase shifter based analog beamforming.

% 论文结构
% The rest of the paper is organized as follows.
% In Section \ref{SM}, system model is presented.
% The proposed LSTM-based beam tracking scheme is introduced in Section \ref{LBTS}.
% In Section \ref{DG}, the procedure of data generation is discussed.
% Section \ref{SR} provides the simulation results of the proposed scheme, followed by the conclusions in Section \ref{C}.

% 符号使用
The following notation will be used in this paper.
% 矩阵，向量，标量
Matrices, vectors and scalars are denoted by bold uppercase letters (e.g. $\mathbf{A}$), bold lowercase letters (e.g. $\mathbf{a}$) and lowercase letters (e.g. $a$), respectively.
% 转置，共轭转置
$(\cdot)^{T}$ denote transpose and  $(\cdot)^H$ denote conjugate transpose (Hermitian).
% 矩阵指定行、列、元素
$[\mathbf{A}]_{m,:}$, $[\mathbf{A}]_{:,n}$ and $[\mathbf{A}_{m,n}]$ denote the $m$th row, $n$th column and the $m$th row $n$th column entry of $\mathbf{A}$, respectively.
% 向量指定元素
$[\mathbf{a}]_n$ denote the $n$th entry of $\mathbf{a}$.
% 2 范数
Besides, $\Vert{\cdot}\Vert_2$ denote $\ell_2$-norm of a vector.
% 复数、实数集合
$\mathbb{C}$ denote the set of complex number. % and $\mathbb{R}$ denote the set of real number.
% 复高斯、包络高斯、指数分布
Gaussian, complex Gaussian, wrapped Gaussian and exponential distribution are denoted by $\mathcal{N}$, $\mathcal{CN}$, $\mathcal{WN}$ and $\mathcal{E}$, respectively.

\section{System Model}\label{SM}

\begin{figure}[!tbp]
    \centerline{\input{geo}}
    \caption{Channel geometry}
    \label{geo}
\end{figure}

% 场景和天线数
A mmWave vehicular network scenario including a vehicle with $M_r$ antenna elements as receiver and a base station (BS) with $M_t$ antenna elements as transmitter is considered. 
% 天线结构、阵元间距、赋形技术
Both of them equip with uniform linear array (ULA) of half-wave interval antenna as shown in Fig.~\ref{geo}, and adopted analog beamforming based on quantized phase shifter which connect with single analog RF chain.
% 阵列响应矢量
The array response vector of a ULA with $M$ half-wave interval antenna elements is given by:
\begin{equation}
    \mathbf{a}( M,\varphi ) =\frac{1}{\sqrt{M}}\left[ 1,e^{j\pi cos( \varphi )} ,...,e^{j\pi ( M-1) cos( \varphi )}\right]^{T}
    \label{arv}
\end{equation}
where $\varphi$ is the arrival angle of the signal. When AoA of the vehicle is $\phi$ and AoD of the BS is $\theta$, the array response vectors of both are $\mathbf{a}_{r}( \phi ) =\mathbf{a}( M_{r} ,\phi )$ and $\mathbf{a}_{t}( \theta ) =\mathbf{a}( M_{t} ,\theta )$, respectively.

% 信道模型
A statistical 28 GHz mmWave channel model in \cite{Akdeniz2014} is taken as channel model in this paper, which is modeled by real experimental data collected in New York City.
The narrowband time-varying $L$ subpaths channel matrix between the vehicle and BS at $n$th time step is $\mathbf{H}_{n} \in \mathbb{C}^{M_{r} \times M_{t}}$, which is given as:
\begin{equation}
    \mathbf{H}_{n} =\frac{1}{\sqrt{L}} \sum\limits ^{L}_{l=1} g_{ln}\mathbf{a}_{r}( \phi _{ln})\mathbf{a}^{H}_{t}( \theta _{ln})
    \label{cm}
\end{equation}
where $g_{ln} \in \mathbb{C}$ is complex small-scale fading gain on subpath $l$ at $n$th time step, $\phi_{ln}$ and $\theta_{ln}$ are the AoA and AoD of the $l$th subpath at $n$th time step, respectively. 
$\phi_{ln} = \phi_n + \Delta \phi_{ln}$ and $\theta _{ln} =\theta _{n} +\Delta \theta _{ln}$, where $\phi_{n}$ and $\theta_{n}$ is the AoA and AoD of the cluster center at $n$th time step, $\Delta \phi _{ln} \sim \mathcal{WN}( \delta ^{2}_{rn})$, $\Delta \theta _{ln} \sim \mathcal{WN}( \delta ^{2}_{tn})$, $\delta_{tn} \sim \mathcal{E}(\lambda_t)$ and $\delta_{rn} \sim \mathcal{E}(\lambda_r)$.
$\lambda_t$ and $\lambda_r$ are root-mean-square (RMS) angular spread of transmitter and receiver, respectively.
The complex small-scale fading gain is given by:
\begin{equation}
    g_{ln} =\overline{g}_{ln} e^{j2\pi t_{n} f_{Dn,max} cos( \omega _{ln})}, \overline{g}_{ln} \sim \mathcal{CN}\left( 0, 10^{-0.1PL_n}\right)
    \label{ssfg}
\end{equation}
where $t_{n}$ is the signal transmission time at $n$th time step, $f_{Dn,max} ={v_{n}}/{\lambda _{c}}$ is maximum Doppler shift at $n$th time step, $v_{n}$ is the speed of vehicle at $n$th time step, $\lambda _{c}$ is the carrier wavelength, $\omega _{ln} = \phi_{ln} - \pi / 2$ is the AoA of subpath $l$ relative to the direction of vehicle at $n$th time step, and $PL_n$ is omnidirectional path loss at $n$th time step, which is defined as:
\begin{equation}
    PL_n = 61.4 + 20 \log(d_n) + \xi~[dB]
    \label{pl}
\end{equation}
where $d_n$ is distance between the vehicle and the BS at $n$th time step, and $\xi \sim \mathcal{N}(0, \sigma_p^2)$.
Note that only the case of single cluster under line-of-sight (LOS) condition is considered in this paper, and the cluster angles depend on the geometric position of the vehicle and the BS.

% 接收信号
For a transmitted signal $x_n$ from the BS, received signal $y_n$ in the vehicle at $n$th time step is:
\begin{equation}
    y_n = \mathbf{w}^H_n \mathbf{H}_n \mathbf{f}_n x_n + \mathbf{w}^H_n \mathbf{v}_n
    \label{rs}
\end{equation}
where $\mathbf{w}_n$ and $\mathbf{f}_n$ are combining vector and beamforming vector at $n$th time step, respectively. $\mathbf{v}_n$ is Gaussian noise at time step $n$ and $\mathbf{v}_n \sim \mathcal{CN}(0, \sigma^2_v \mathbf{I}_{M_r})$. 

\section{LSTM-based Beam Tracking Solution}\label{LBTS}

% 网络
\subsection{The LSTM Network}

% 问题定义
The purpose of beam tracking is to obtain beam angles with as few beam measurements as possible for reducing the overhead brought by beam alignment.
Since the vehicle must travel in a particular direction on the road and the mmWave beams are correlated with the position of vehicles \cite{Aviles2016, Wang2019}, the problem of beam tracking can be formulated as a time series regression problem after the historical beam angles of vehicles is collected.

% LSTM 方案
An artificial neural network named LSTM network is used to solve this regression problem.
It has been implemented successfully in several fields such as machine translation, image captioning, speech recognition, and even stock prices prediction in economy.
As one of the recurrent neural networks (RNNs), LSTM is generally considered to be more robust to long time series than simpler vanilla RNN implementations \cite{Hochreiter1997}.
It is powerful for handling time series data and learning long-term relations between features, relying on three gates, i.e. forget, input and output gates composed of neural networks (NNs) in LSTM cells.

\begin{figure}[tbp]
    \centerline{\input{lstm}}
    \caption{Structure of network}
    \label{lstm}
\end{figure}

% 结构
Fig.~\ref{lstm} shows the structure of the network, which is a sequential model comprises two LSTM layers with 50 hidden units, two dropout layers with 0.2 probability and a fully connected layer with 2 nodes.
The output of the first LSTM layer is a sequence of length $n_{LSTM}$, which is used as the input of the second LSTM layer.
And two dropout layers are set to prevent overfitting. 

% 损失函数？
\subsection{Loss Function}

Mean Square Error (MSE) is the most commonly used regression loss function for quantifying the error of prediction.
In \cite{Burghal2019}, considering the problem of angle ambiguity due to the periodicity of the beam angle results in unnecessary loss for large difference of beam angle when used MSE, D. Burghal et al. proposed to use a shifted cosine function as the loss function. 
However, when using this loss function, the training process may be unstable due to the multiple global minima, and the responses may not converge in a reasonable interval.

In addition, another problem is that the codewords whose beam angle near $0$ or $\pi$ have close gains at two different angles, resulting in unnecessary loss in some cases, as shown in Fig.~\ref{results_gain}.
For instance, in the case of the codeword whose beam angle is $\pi$, there are same gains at $0$ and $\pi$. 
The loss should be small, even zero, if estimated angle is $0$ and predicted angle is $\pi$, although the absolute difference of them is $\pi$.
A straightforward idea is taking $1-|\mathbf{a}^{H}(M, \theta^e)\mathbf{a}(M, \theta^p)|$ as the loss.
Calculating this loss, however, requires array response vectors of estimated angle and predicted angle at the corresponding time step, which will increase the computational cost when training network.
On the other hand, considering it is a complex function, it will be difficult to perform backpropagation (BP).

\begin{figure}[!b]
    \centering
    \includegraphics[scale=0.59]{results_gain}
    \caption{Heatmap of $|\mathbf{a}^{H}(16, \theta^e)\mathbf{a}(16, \theta^p)|$}
    \label{results_gain}
\end{figure}

Hence, to avoid the problem of angle ambiguity, the AoAs and AoDs are limited in $(0, \pi]$ by simple conversion before training.
And considering complexity of computation, a modified MSE is used as loss function, which is given as:
\begin{equation}
    Loss = \frac{1}{N} \sum_{i=1}^{N}\left[(\phi^{p}_{i} - \phi^{e}_{i})^2 + (\theta^{p}_{i} - \theta^{e}_{i})^2\right]
    \label{lf}
\end{equation}
where $N$ is the number of training samples, $\phi ^{e}_{i}$, $\theta ^{e}_{i}$, $\phi ^{p}_{i}$, $\theta ^{p}_{i}$, are the estimated AoA, estimated AoD, predicted AoA, and predicted AoD, respectively, for training sample $i$.

% 预测过程
\subsection{Procedure of Beam Tracking}

Before exploiting the LSTM network for beam tracking, the BS demands to collect historical beam angles, which are estimated by the vehicle using exhaustive beam search, for training the LSTM network.
At time step $k$, the network takes the AoAs and AoDs from time step $k - n_{LSTM}$ to $k - 1$ as features and the AoA and AoD at time step $k$ as responses.
The dataset is consisted of time series AoAs and AoDs of the vehicle from initial access to disconnection.

After the LSTM network has been trained, the vehicle takes exhaustive beam searches in consecutive $n_{LSTM}$ time steps to obtain initial estimated AoAs and AoDs at the beginning of a round of beam tracking. 
The network will take the initial estimated AoAs and AoDs to predict AoA and AoD at next time step. 
Then, the predicted AoA and AoD and the AoAs and AoDs of last $n_{LSTM} - 1$ time steps in last feature will be used to compose new feature.

Once the predicted AoA and AoD are obtained, the codewords whose steering angle closest to the predicted beam angles will be taken as beamforming and combining vectors.
For every time step, SNR under current prediction will be calculated and compared with a threshold ${SNR}_T$.
The network will repeat to use predicted result to compose new features to predict AoA and AoD at next time step, when the calculated SNR is greater than ${SNR}_T$.
Otherwise, a new round of estimation and prediction will be executed.

It makes more sense to take the SNR of received signal rather than the absolute difference between predicted and estimated angles as a threshold, because there is no way to obtain a precise beam angle for judgment until it is accurately measured or predicted.

%% 快速中断恢复算法？
%\subsection{Fast Outage Recovery}

\section{Data Generation}\label{DG}

% 信道矩阵
\subsection{Channel Matrix}

\begin{figure}[!tbp]
    \centerline{\input{scene}}
    \caption{Scene of mmWave vehicular networks for data generation}
    \label{scene}
\end{figure}

% 场景介绍
A road traffic simulation software named ``SUMO'' is used to generate time series information of the vehicle in the scenario mentioned in Section \ref{SM}, which including a BS and a vehicle driving on road as shown in Fig.~\ref{scene}.
The vehicle departs from $(0, 100)$ at first time step, and arrives $(100, 0)$ at final time step.
Note that the speed of vehicle is non-linear and it depends on the road conditions and behavior of the driver which is defined by SUMO.

% 几何信息
The generated vehicle time series information is composed of position, speed $v_n$ and directional angle $\beta_n$ of the vehicle at each time step.
For $n$th time step, the position of vehicle is given by $(x_{rn}, y_{rn})$, $v_n$ is used to determine maximum Doppler shift in \eqref{ssfg}, and $\beta_n$ is used to determine $\phi_{ln}$ and $\omega_{ln}$.

Once the position of the vehicle and the BS are obtained, $\theta_n$ and $\phi_n$ can be calculated by simple geometric methods as following:
\begin{equation}
    \begin{cases}
    \theta _{n} =\arg( \Gamma _{xn} +j\Gamma _{yn})\\
    \phi _{n} =\arg( \Gamma _{xn} +j\Gamma _{yn}) -\beta _{n}
    \end{cases}
    \label{ba}
\end{equation}
where $\Gamma _{xn} =x_{rn} -x_{t}$, $\Gamma _{yn} =y_{rn} -y_{t} $, and $(x_{t}, y_{t})$ are coordinates of the BS. 
Furthermore, the signal transmission time $t_n = d_n / c$ can be calculated, where the distance between the BS and the vehicle is $d_n = \sqrt{\Gamma_{xn}^2 + \Gamma_{yn}^2}$, and $c$ is light speed.
Now the channel matrix at each time step can be obtained from \eqref{arv}, \eqref{cm}, \eqref{ssfg}, \eqref{pl} and \eqref{ba}.

% 波束角度
\subsection{Beam Search}

% 管理方式
In this paper, downlink (DL) configuration scheme is considered for beam management.
The beam management procedure is as follows. The reference signals are sent to the vehicle from the BS, the vehicle measures and determines the optimal beam pair for communication, then feeds back to the BS.

% 码本设计
The AoAs and AoDs measured from exhaustive beam search scheme is used to train the network, rather than using the generated channel data directly.
Although the AoAs and AoDs are in $(0, 2\pi]$, only the angles in $(0,\pi]$ are considered, since the cosine function is symmetric around $\pi$.
To reduce the overhead of beamforming, a discrete resolution $b$-bit codebook is adopted to perform beam search, where $b$ is the number of bits for quantized phase shifters.
For a $b$-bit codebook, it is consisted of $2^b$ beam patterns.
In this paper, $b$ is assumed to be $2log_2 M$ for a $M$-element antenna terminal, and the candidate beam angles vector $\mathbf{b}_M$ is given by:
\begin{equation}
    \mathbf{b}_M = \left[\frac{1}{2M}\pi, \frac{2}{2M}\pi, ..., \frac{2M-1}{2M}\pi, \pi\right]
\end{equation}
So, there are $2M_r$ beam patterns for the vehicle, and $2M_t$ beam patterns for the BS.
Note that another codebook which achieves uniform maximum gain in all direction is not used for this solution, because its low spatial resolution near $0$ and $\pi$ resulting in network underfitting.
The beam codebooks of the vehicle and the BS are:
\begin{gather}
    \begin{aligned}
        \mathbf{W} =&\left[\mathbf{a}_{r}([\mathbf{b}_{M_r}]_1) ,\mathbf{a}_{r}\left([\mathbf{b}_{M_r}]_2 \right) ,...,\mathbf{a}_{r}\left([\mathbf{b}_{M_r}]_{2M_r} \right)\right] \\
        \mathbf{F} =&\left[\mathbf{a}_{t}([\mathbf{b}_{M_t}]_1) ,\mathbf{a}_{t}\left([\mathbf{b}_{M_t}]_2 \right) ,...,\mathbf{a}_{t}\left([\mathbf{b}_{M_t}]_{2M_t} \right)\right]
    \end{aligned}
\end{gather}
where $\mathbf{W} \in \mathbb{C}^{M_{r} \times 2M_{r}}$ is the codebook of vehicle, and $\mathbf{F} \in \mathbb{C}^{M_{t} \times 2M_{t}}$ is the codebook of BS. Each column of the codebook represents a beam pattern, each entry in the column is phase rotation for corresponding antenna element to generate directional beam.

% 观察信号
Assume $x_n = 1$ is sent as reference signal, the observation matrix comprises all measurement of exhaustive search now can be given by:
\begin{equation}
    \mathbf{Y}_{n} =\mathbf{W}^{H}\mathbf{H}_{n}\mathbf{F} +\mathbf{V}_{n}
\end{equation}
where $\mathbf{V}_n \in \mathbb{C}^{2M_r \times 2M_t}$ is Gaussian noise matrix composed of independent identically distribution (i.i.d.) elements, which are the noise part of \eqref{rs}. $\mathbf{Y}_n \in \mathbb{C}^{2M_r \times 2M_t}$, $[\mathbf{Y}_n]_{i,j}$ is the received signal used $[\mathbf{W}]_{:,i}$ as combining vector and $[\mathbf{F}]_{:,j}$ as beamforming vector.

% 最优波束
For each time step, both of the vehicle and the BS use their codebook to perform exhaustive beam search to find the optimal beam pair.
The indexes of optimal beam pair can be obtained by solving an optimization problem as following:
\begin{equation}
    \begin{aligned}
        ( i_{n}^* ,j_{n}^*) =~&\underset{i_{n} ,j_{n}}{\operatorname{argmax}}\Vert [\mathbf{Y}_{n}]_{i_{n} ,j_{n}}\Vert _{2} \\
        s.t.~&i_{n} \in [ 1,2M_{r}], \\
        &j_{n} \in [ 1,2M_{t}]
    \end{aligned}
\end{equation}
A simple nested loop algorithm can be exploited to solve this problem. Then, at $n$th time step, the optimal combining vector $\mathbf{w}^{*}_{n}$ and the optimal beamforming vector $\mathbf{f}^{*}_{n}$ are $\mathbf{w}^{*}_{n}=[\mathbf{W}]_{:,i_{n}^*}$ and $\mathbf{f}^{*}_{n}=[\mathbf{F}]_{:,j_{n}^*}$, respectively. And the estimated AoA $\phi ^{e}_{n}$ and AoD $\theta ^{e}_{n}$ used for training are given by:
\begin{equation}
    \begin{cases}
        \phi ^{e}_{n} = \frac{i_{n}^* \pi}{2M_{r}}\\
        \theta ^{e}_{n} = \frac{j_{n}^* \pi}{2M_{t}}
    \end{cases}
\end{equation}
The advantage of training with radian instead of the codeword indexes is that it allows the proposed beam tracking solution to be generalized under terminals with different antenna configuration and beamforming techniques, without additional computation and transmitted data.

% 数据平滑
Note that due to the limited resolution of the beam codebook and the noise received at the vehicle, there will be some errors for the channel estimation, which are reflected in fluctuations in the estimated time series AoAs and AoDs.
To reduce the fluctuations, a first order Savitzky-Golay filter \cite{Savitzky1964} with frame length 21 is used to smooth the estimated AoAs and AoDs for training the LSTM network better.

%% 角度范围
%\subsection{Range of AoAs and AoDs}

%After getting the AoAs and AoDs for all time step, we use a time windows of 1 second to get the range of them for a total of 11 time steps, including the current time step and 10 future time steps.

\section{Simulation Results}\label{SR}

In this section, performances of the proposed LSTM-based beam tracking solution are presented by analyzing the SNR of received signal, number of measurements and outage probability.
The outage probability for a simulation is given by:
\begin{equation}
    P_{o} =\frac{\sum ^{N}_{i=1}\mathbf{I}( {SNR}_{i} \leqslant {SNR}_{T})}{N}
\end{equation}
where ${SNR}_i$ is the SNR of received signal for the $i$th sample and $\mathbf{I}$ is an indicator function.

\begin{figure}[!b]
    \centering
    \subfigure[RMSE of the LSTM Network]{
        \includegraphics[scale=0.65]{results_rmse}
        \label{results_rmse}
        }
    \subfigure[Loss of the LSTM Network]{
        \includegraphics[scale=0.65]{results_loss}
        \label{results_loss}
    }
    \caption{Convergence of the LSTM network}
    \label{results_convergence}
\end{figure}

In this paper, the sample rate of series channel data is $20$ Hz ($50$ ms interval) and there are total $613$ samples for training and $401$ samples for testing. 
Table \ref{t_SP} shows the common simulation parameters.
For each simulation, parameters default to the values in Table \ref{t_SP}, except for those mentioned specifically.

% 仿真参数
\begin{table}[!t]
    \renewcommand{\arraystretch}{1.3}
    \caption{Simulation Parameters}
    \label{t_SP}
    \centering
    \begin{tabular}{l c}
        \hline
        \bfseries Parameters & \bfseries Values\\
        \hline
        Carrier frequency $f_{c}$ & $28 \times 10^9$ Hz\\
        Coordinates of BS $(x_t, y_t)$ & $(80, 80)$\\
        Number of antenna elements for BS $M_t$ & $16$\\
        Number of antenna elements for Vehicle $M_r$ & $4$\\
        Number of subpaths $L$ & $20$\\
        Expectation of BS RMS angular spread $\lambda_t$ & $10.2 \degree$\\
        Expectation of Vehicle RMS angular spread $\lambda_r$ & $15.5 \degree$\\
        Path loss standard deviation $\sigma_p$ & $5.8$ dB\\
        Noise variance of received signal $\sigma_v^2$ & $-140$ dBW\\
        Threshold of SNR ${SNR}_T$ & $5$ dB\\
        Lookback of LSTM $n_{LSTM}$ & $5$\\
        Optimizer of LSTM & Adam\\
        Training Epochs & 400\\
        Learning rate & 0.05\\
        \hline
    \end{tabular}
\end{table}
    
% 收敛性能？
Fig.~\ref{results_convergence} demonstrates the convergence of the LSTM network.
The root-mean-square error (RMSE) of the LSTM network is shown in Fig.~\ref{results_rmse}.
It is observed that the RMSE rapidly converges to about $0.4$ around $50$th epoch, and finally converges to about $0.2$ after $400$ epochs.
And the loss of the LSTM network is shown in Fig.~\ref{results_loss}.
It shows that the loss decreases sharply around $20$ epochs, and converges to a small value about $0.01$ after $400$ epochs.

% 16 * 4 天线，不同噪声方差下的平均 SNR，中断次数和观测次数
% 随着噪声方差增大，平均 SNR 降低，中断次数和观测次数增多。
\begin{figure}[!b]
    \centering
    \includegraphics[scale=0.59]{results_noise}
    \caption{Average SNR and outages probability versus $\sigma_v^2$}
    \label{results_noise}
\end{figure}

Fig.~\ref{results_noise} shows the performances of schemes versus noise variance of received signal.
The vehicle which adopts exhaustive scheme uses exhaustive search method to find the optimal beam angles at each time step.
It illustrates that for both exhaustive and LSTM-based scheme, the average SNR of received signal is decreasing and the probability of outages is increasing with the increasing of $\sigma_v^2$.
The difference in SNR between LSTM-based scheme and exhaustive scheme is small, up to about $10$ dB.
When $\sigma_v^2=-140$ dBW, there is not any outage in exhaustive scheme, and the average SNR of received signal in exhaustive scheme is $55.62$ dB compared to $51.93$ dB in LSTM-based scheme, with a loss of only $3.69$ dB in SNR, implying a loss of about $6.7$\% in spectral efficiency.
\begin{table}[!t]
    \newcommand{\tabincell}[2]{\begin{tabular}{@{}#1@{}}#2\end{tabular}}
    \renewcommand{\arraystretch}{1.3}
    \centering
    \begin{threeparttable}
    \caption{\label{t_NM}Comparisons of the Number of Measurements}
        \begin{tabular}{c c c}
            \hline
            \bfseries Schemes & \bfseries Complexity & \tabincell{c}{\bfseries Number of\\ \bfseries Measurements}\\
            \hline
            LSTM-based & $N_s + 4 N_f M_t M_r$\tnote{1} & $1676$\\
            Hierarchical & $N (2 \log_2{\frac{M_t}{M_r}} + 4 \log_2{2 M_r})$ & $6416$\\ % $N (2 (\log_2{2 M_t} - \log_2{2 M_r}) + 4 \log_2{2 M_r})$
            Exhaustive & $4 N M_t M_r$ & $102656$\\
            \hline
        \end{tabular}
        \begin{tablenotes}
            \item[1] $N_s$ is the number of successful prediction and $N_f = N - N_s$.
        \end{tablenotes}
    \end{threeparttable}
\end{table}

% Since the SNR performance of exhaustive search is considered to be the best, there is a high probability that if there are outages when using exhaustive search, there will also be outages when using other schemes at the same time.
% Fig.~\ref{results_noise} shows that there is not any outages when the noise variance is lower than $-140$ dBW.
% Therefore, the default noise variance of received signal is defined as $-140$ dBW for simulations to ensure that there are not any outages when using exhaustive search to acquire AoAs and AoDs in this scenario.
% 
Table \ref{t_NM} shows the comparison of the number of measurements in different schemes.
Compared with the exhaustive scheme, the proposed LSTM-based scheme can reduce about $98.4$\% measurement overhead.
Considering the significant reduction in measurement overhead, the $6.7$\% loss of spectral efficiency in Fig.~\ref{results_noise} seems to be acceptable.
Note that the proposed LSTM-based scheme obtain initial beam angles for prediction by exhaustive search method in this paper, and it is obvious that the measurement overhead can be further reduced by utilizing a smart beam search method (e.g. hierarchical method).

% 不同规格天线，10^(-14) 噪声方差的比较
% 少天线效果好，中天线效果最佳，多天线效果回落。

\begin{figure}[!t]
    \centering
    \includegraphics[scale=0.59]{results_antenna}
    \caption{Average SNR and outages probability versus $M_t \times M_r$}
    \label{results_antenna}
\end{figure}

Fig.~\ref{results_antenna} shows the performances of schemes versus antenna size $M_t \times M_r$.
It illustrates that the performances of LSTM-based scheme is decreasing with the increasing of antennas size.
The reason is the beamwidths of the vehicle and the BS are so small when antenna size is large that reducing the error tolerance for prediction and making it difficult for LSTM-based scheme to accurately align with each other.
It is observed that there are fluctuations in both SNR and outages probability, due to the randomness of the channel which is caused by the statistical characteristics (e.g. angular spread, noise variance, etc.) of the channel and the vehicle movement.

\section{Conclusions}\label{C}

This paper studies the beam tracking problem in mmWave vehicular network with ULA.
A LSTM-based beam tracking scheme is proposed to reduce the beam alignment overhead in a common vehicular scenario.
In order to train and evaluate the proposed scheme, a time series channel data is set up by statistical channel model using time series vehicle information generated from SUMO.
Simulation results have verified the proposed LSTM-based scheme can reduce significant measurement overhead compared with the exhaustive scheme, while ensuring an acceptable loss in spectral efficiency.

\section*{Acknowledgment}

This work was supported in part by the National Natural Science Foundation of China (00000000), in part by the Beijing Key Laboratory of Network System Architecture and Convergence and in part by Beijing Laboratory of Advanced Information Networks.

\bibliographystyle{IEEEtran}
\bibliography{references}

\end{document}