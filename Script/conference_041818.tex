\documentclass[conference]{IEEEtran}
\IEEEoverridecommandlockouts
% The preceding line is only needed to identify funding in the first footnote. If that is unneeded, please comment it out.
\usepackage{cite}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{algorithmic}
\usepackage{graphicx}
\usepackage{textcomp}
\usepackage{xcolor}

% For fig
\usepackage{physics}
\usepackage{amsmath}
\usepackage{tikz}
\usepackage{mathdots}
\usepackage{yhmath}
\usepackage{cancel}
\usepackage{color}
\usepackage{siunitx}
\usepackage{array}
\usepackage{multirow}
\usepackage{amssymb}
\usepackage{gensymb}
\usepackage{tabularx}
\usepackage{booktabs}
\usepackage{threeparttable}
\usepackage{subfigure}
\usepackage{bm}
\usetikzlibrary{fadings}
\usetikzlibrary{patterns}
\usetikzlibrary{shadows.blur}
\usetikzlibrary{shapes}

\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}
\begin{document}

\title{FC-BET: A Fast Consecutive Beam Tracking Scheme for MmWave Vehicular Communications}

\author{
    \IEEEauthorblockN{Chen Wang, Yawen Chen, Zhaoming Lu, Xiangming Wen, Zifan Wang, Luhan Wang}
    \IEEEauthorblockA{
        \textit{Beijing Key Laboratory of Network System Architecture and Convergence} \\
        \textit{Beijing Laboratory of Advanced Information Networks} \\
        \textit{Beijing University of Posts and Telecommunications} \\
        Beijing, China \\
        wangchen@bupt.edu.cn}
}

\maketitle

\begin{abstract}
Millimeter wave (mmWave) communication is a promising technique to meet the demands of data-rate hungry applications in vehicular networks.
Multiple-input multiple-output (MIMO) and beamforming technique are usually adopted in mmWave communications to overcome the high path and penetration losses.
However, the high mobility of vehicles would result in significant beam training overhead in the mmWave vehicular communications.
Hence, in this paper, a fast consecutive beam tracking (FC-BET) scheme based on long short-term memory (LSTM) is proposed.
By predicting beam angles through the LSTM network consecutively, the overhead caused by frequent beam training in mmWave vehicular communications can be reduced.
To evaluate the proposed scheme, a time series channel dataset is built by using sequential vehicle information generated from road traffic simulation software named ``Simulation of Urban MObility (SUMO)''.
Simulation results show that the FC-BET scheme can significantly reduce overhead with an acceptable loss in spectral efficiency compared with conventional beam training schemes.
\end{abstract}

\begin{IEEEkeywords}
beam tracking, mmWave, MIMO, LSTM, vehicular communications
\end{IEEEkeywords}

\section{Introduction}
% 毫米波依靠丰富的频谱资源，可以有效提高传输速率，是通信未来发展的重要技术之一 *。
MmWave is one of the important technologies for the future wireless networks, relying on abundant spectrum resources \cite{Rangan2014, Kutty2016}.
% 为了更好地应用的毫米波，需要克服毫米波高频导致的极高的路径和穿透损耗 *。
In order to use mmWave to increase transmission rate effectively, the high path and penetration loss caused by high frequency of mmWave need to be overcome \cite{Zhao2013}. 
% 得益于毫米波毫米级的波长，可能将阵列天线集成进终端，并使用阵列天线的波束赋形技术，将天线能量约束在指定方向，获取高增益 *。
Fortunately, it is possible to integrate mmWave phased array antennas into small chip with the help of short wavelength of mmWave, and use beamforming to deliver signal power in specified direction to overcome the losses \cite{Heath2016}.
% 目前波束赋形技术主要包括，模拟波束赋形，数字波束赋形和混合波束赋形，考虑到数字波束赋形技术较大的硬件和计算开销，目前较多的研究主要集中在模拟波束赋形，和混合波束赋形方案上 *。
% Several beamforming techniques are most commonly used for beamforming, i.e. analog, digital and hybrid beamforming \cite{Kutty2016}.
% Considering digital beamforming is prohibitively complex and costly, it has not been largely adopted by both indoor and outdoor mmWave communications, and most of the researches focused on analog and hybrid beamforming \cite{Kutty2016}.
% 得益于毫米波毫米级的波长，可能将阵列天线集成进终端，并使用阵列天线的波束赋形技术提高增益，克服毫米波高频导致的高路径和穿透损耗 *。
% With the help of short wavelength of mmWave, it is possible to integrate mmWave phased array antennas into small chip, and use beamforming to improve gain for overcoming the high path and penetration loss caused by high frequency of mmWave \cite{Heath2016,Zhao2013}.

% 不同于传统全向天线，阵列天线的信道具有方向性 *，这意味着若想形成较高的波束增益，必须保证接收端和发送端的波束之间相互对准，否则波束对的失准将会带来严重的增益下降，降低通信性能。
Unlike conventional omnidirectional antennas, mmWave array antennas are directional \cite{Giordani2019}, which means that if high antenna gain needs to be achieved, the well alignment between beams generated by the transmitter and receiver is required. 
Misalignment of the beam pairs will result in reducing gain and degrading performance.
% 802.11ad 标准中的波束扫描
A straightforward solution is the exhaustive search.
However, it has significant overhead, and is not suitable for fast-changing environments \cite{Va2017}.
% 研究 * 提出了一种分级码本的设计，本质是采用了二分查找的方式，在不同阶段使用不同宽度的波束进行波束扫描并获得最佳波束对，以此减少开支。然而，这种算法需要量化相移器具有较高的量化水平，并且有可能需要多个射频链来实现，这导致采用这种算法方案的成本极高。
To reduce the overhead, hierarchical search was proposed in \cite{Alkhateeb2014}, which essentially exploits binary search algorithm to find the optimal beam.
This algorithm requires a high quantization level phase shifter and potentially multiple RF chains to implement, which leads to high cost.
% * 在此基础上加以改进采用 EKF，并且只需要单次测量，更适用于在快速变换环境下的信道追踪。
% Based on Zhang's work, \cite{Va2017} exploits extended Kalman filter and requires only a single measurement, making it more suitable for beam tracking in fast-changing environments.

% mmWave 应用于车联网的意义
Vehicular networks enable vehicles to connect to the Internet for information dissemination and infotainment (e.g. real-time sensor data, map data, emergency messages, multimedia streaming, etc.) via roadside Infrastructure \cite{Zheng2015}.
The transmission of huge amounts of information require high data rate, and mmWave allow vehicular networks to meet the requirement.
% 相较于低速的用户终端，为高速车辆提供可靠的波束对准更具挑战性，因为车辆较高的速度将会导致车辆更快驶出波束的覆盖范围。
However, providing reliable beam alignment for mmWave vehicular communications is more challenging, due to the high mobility of vehicles. 
%为了保证车辆始终被较高增益的波束覆盖，需要进行高频率的对准，而高频的波束会进一步加大系统的开支，尤其是当采用高分辨率码本的时候。
Frequent beam training is required to ensure that the vehicles are always covered by high gain beams.
This will further increase system overhead, especially when high resolution codebooks are used.
% 幸运的是，由于毫米波信道的稀疏性 *，且毫米波信道的 AoA、AoD 与收发端位置的具有一定的相关性 *，在 LOS 信号下沿固定道路行驶的车辆的 AoA 和 AoD 应该能被很好的预测出来。
Fortunately, owing to the sparsity of mmWave channel \cite{Lee2014} and the correlation between the angles of arrival/departure (AoAs/AoDs) of the channel and the positions of the receiver and transmitter \cite{Aviles2016}, the optimal beam angles of a vehicle traveling along a road under line-of-sight (LOS) condition can be well predicted.
% 提出了一种基于卡尔曼滤波器使用穷尽扫描进行波束追踪的方案，以减少系统的开支，然而穷尽扫描所需要的测量次数和协议开支会随着天线数的增加而增加。
A Kalman filter based beam tracking scheme was proposed for mobile mmWave channels, whose beam training overheads increase with the number of elements in antenna \cite{Zhang2016}.
% 机器学习方法 1
Wang et al. proposed a situational awareness-aided beam training solution using machine learning in mmWave Vehicles-to-Infrastructure (V2I) communication, which requires accurate localization of vehicles \cite{Wang2019}. 
In practice, the inaccuracy of situational awareness may be caused by localization error and other factors, resulting in beam misalignment.
% 机器学习方法 2
In \cite{Guo2019}, Guo et al. proposed a machine learning based tracking algorithm which utilizes the past channel state information (CSI) to predict the future CSI of vehicles.
However, it cannot predict CSI consecutively, and can only reduce the overhead by half compared with conventional algorithms.
% EKF

% 本文提出了一种基于 LSTM 网络的波束追踪方法，使用 LSTM 网络，通过对历史车辆穷尽扫描所获得的历史信道信息进行学习，根据当前车辆在一定时间步的信道信息，预测在下一时刻的 AoA 和 AoD，以达到减少系统开支的效果。
In this paper, a fast consecutive beam tracking scheme based on LSTM is proposed, called FC-BET.
The historical optimal beam angles, which were obtained from exhaustive beam search, are exploited to train a LSTM network. 
By leveraging the LSTM network, current AoA and AoD between vehicles and the base station (BS) can be predicted simultaneously with less beam training.
% 仿真过程
% In each round of tracking, the predicted beam angles will be used to select beamforming codeword and compose new feature, until the signal-to-noise ratio (SNR) of received signal less than or equal to a threshold.
% 此外，为了获取信道数据用以训练神经网络，交通流仿真软件 SUMO 被用来生成时序车辆信息，结合统计信道模型与生成的时序车辆信息，生成了时序的信道信息。
In addition, a road traffic simulation software is used to generate sequential vehicle information to set up time series channel data with a statistical channel model which is modeled by real experimental data for evaluating the scheme.
Simulation results show that compared with conventional schemes, FC-BET scheme requires less measurements while maintaining high spectral efficiency.

% 论文结构
% The rest of the paper is organized as follows.
% In Section \ref{SM}, system model is presented.
% The proposed FC-BET beam tracking scheme is introduced in Section \ref{LBTS}.
% In Section \ref{DG}, the procedure of data generation is discussed.
% Section \ref{SR} provides the simulation results of the proposed scheme, followed by the conclusions in Section \ref{C}.

% 符号使用
The following notation will be used in this paper.
% 矩阵，向量，标量
Matrices, vectors and scalars are denoted by bold uppercase letters (e.g. $\mathbf{A}$), bold lowercase letters (e.g. $\mathbf{a}$) and lowercase letters (e.g. $a$), respectively.
% 转置，共轭转置
$(\cdot)^{T}$ denote transpose and  $(\cdot)^H$ denote conjugate transpose (Hermitian).
% 矩阵指定行、列、元素
$[\mathbf{A}]_{m,:}$, $[\mathbf{A}]_{:,n}$ and $[\mathbf{A}_{m,n}]$ denote the $m$th row, $n$th column and the $m$th row $n$th column entry of $\mathbf{A}$, respectively.
% 向量指定元素
$[\mathbf{a}]_n$ denote the $n$th entry of $\mathbf{a}$.
% 2 范数
Besides, $\Vert{\cdot}\Vert_2$ denote $\ell_2$-norm of a vector.
% 复数、实数集合
$\mathbb{C}$ denote the set of complex number. % and $\mathbb{R}$ denote the set of real number.
% 复高斯、包络高斯、指数分布
Gaussian, complex Gaussian, wrapped Gaussian and exponential distribution are denoted by $\mathcal{N}$, $\mathcal{CN}$, $\mathcal{WN}$ and $\mathcal{E}$, respectively.

\section{System Model}\label{SM}

\begin{figure}[!t]
    \centerline{\input{geo}}
    \caption{Channel geometry}
    \label{geo}
\end{figure}

% 场景和天线数
A mmWave vehicular communication scenario including a vehicle with $M_r$ antenna elements and a BS with $M_t$ antenna elements is considered, as shown in Fig.~\ref{geo}.
% 天线结构、阵元间距、赋形技术
Both of them are equipped with a single RF chain and uniform linear array (ULA) of half-wave interval antenna.
Analog beamforming based on quantized phase shifter is adopted at both BS and vehicle. 

% 信道模型
The Saleh-Valenzuela channel model is taken as channel model in this paper.
The definitions of channel parameters refer to $28$ GHz model \cite{Akdeniz2014}, which are derived by real experimental data measured in New York City.
And only the case of single cluster under LOS condition is considered in this paper.
The narrowband time-varying $L$ subpaths channel matrix between the vehicle and BS at $n$th time step is $\mathbf{H}_{n} \in \mathbb{C}^{M_{r} \times M_{t}}$, which is given as:
\begin{equation}
    \mathbf{H}_{n} =\sqrt{\frac{M_r M_t}{L}} \sum\limits ^{L}_{l=1} g_{ln}\mathbf{a}_{r}( \phi _{ln})\mathbf{a}^{H}_{t}( \theta _{ln})
    \label{cm}
\end{equation}
where $g_{ln} \in \mathbb{C}$ is complex fading gain on subpath $l$, $\phi_{ln}$ and $\theta_{ln}$ are the AoA and AoD of the $l$th subpath, respectively. 
$\phi_{ln} = \phi_n + \Delta \phi_{ln}$ and $\theta _{ln} =\theta _{n} +\Delta \theta _{ln}$, where $\phi_{n}$ and $\theta_{n}$ is the AoA and AoD of the cluster center, $\Delta \phi _{ln} \sim \mathcal{WN}( \delta ^{2}_{rn})$, $\Delta \theta _{ln} \sim \mathcal{WN}( \delta ^{2}_{tn})$, $\delta_{tn} \sim \mathcal{E}(\lambda_t)$ and $\delta_{rn} \sim \mathcal{E}(\lambda_r)$.
$\lambda_t$ and $\lambda_r$ are root-mean-square (RMS) angular spread of transmitter and receiver, respectively.
Note that the cluster angles depend on the geometric position of the vehicle and the BS.
The complex fading gain on $l$th subpath at $n$th time step is given by:
\begin{equation}
    g_{ln} =\overline{g}_{ln} e^{j2\pi t_{n} f_{Dn,max} cos( \omega _{ln})}, \overline{g}_{ln} \sim \mathcal{CN}\left( 0, 10^{-0.1PL_n}\right)
    \label{ssfg}
\end{equation}
where $t_{n}$ is the signal transmission time, $f_{Dn,max} ={v_{n}}/{\lambda _{c}}$ is maximum Doppler shift, $v_{n}$ is the speed of vehicle, $\lambda _{c}$ is the carrier wavelength, $\omega _{ln} = \phi_{ln} - \pi / 2$ is the AoA of subpath $l$ relative to the direction of vehicle, and $PL_n$ is omnidirectional path loss at time step $n$, which is defined as:
\begin{equation}
    PL_n = 61.4 + 20 \log(d_n) + \xi~[dB]
    \label{pl}
\end{equation}
where $d_n$ is distance between the vehicle and the BS, and $\xi \sim \mathcal{N}(0, \sigma_p^2)$.
% 阵列响应矢量
The array response vector of ULA with $M$ half-wave interval antenna elements is given by:
\begin{equation}
    \mathbf{a}( M,\varphi ) =\frac{1}{\sqrt{M}}\left[ 1,e^{j\pi cos( \varphi )} ,...,e^{j\pi ( M-1) cos( \varphi )}\right]^{T}
    \label{arv}
\end{equation}
where $\varphi$ is the arrival angle of the signal. When AoA of the vehicle is $\phi$ and AoD of the BS is $\theta$, the array response vectors of both are $\mathbf{a}_{r}( \phi ) =\mathbf{a}( M_{r} ,\phi )$ and $\mathbf{a}_{t}( \theta ) =\mathbf{a}( M_{t} ,\theta )$, respectively.

% 管理方式
Beam management procedure is as follows. The reference signals are sent to the vehicle from the BS, the vehicle measures and determines the optimal beam pair for communication, then feeds back to the BS.

% 码本设计
A discrete resolution $b$-bit codebook is adopted to perform beam search, where $b$ is the number of bits for quantized phase shifters.
For a $b$-bit codebook, it is consisted of $2^b$ beam patterns.
In this paper, $b$ is assumed to be $log_2{2M}$ for a terminal with $M$ antennas.
The candidate beam angles vector $\mathbf{b}_{M}$ for the terminal is given by:
% $b$ is assumed to be $2log_2 M$ for a $M$-element antenna terminal, and the candidate beam angles vector $\mathbf{b}_M$ is given by:
\begin{equation}
    \mathbf{b}_{M} = \left[\frac{1}{2M}\pi, \frac{2}{2M}\pi, ..., \frac{2M-1}{2M}\pi, \pi\right]^T
\end{equation}
Thus, there are $2M_r$ beam patterns for the vehicle, and $2M_t$ beam patterns for the BS, and the beam codebooks of the vehicle and the BS are:
% Note that another codebook which achieves uniform maximum gain in all direction is not used for this scheme, due to its low spatial resolution near $0$ and $\pi$ resulting in network underfitting.
% The beam codebooks of the vehicle and the BS are:
\begin{gather}
    \begin{aligned}
        \mathbf{W} =&\left[\mathbf{a}_{r}([\mathbf{b}_{M_r}]_1) ,\mathbf{a}_{r}\left([\mathbf{b}_{M_r}]_2 \right) ,...,\mathbf{a}_{r}\left([\mathbf{b}_{M_r}]_{2M_r} \right)\right] \\
        \mathbf{F} =&\left[\mathbf{a}_{t}([\mathbf{b}_{M_t}]_1) ,\mathbf{a}_{t}\left([\mathbf{b}_{M_t}]_2 \right) ,...,\mathbf{a}_{t}\left([\mathbf{b}_{M_t}]_{2M_t} \right)\right]
    \end{aligned}
\end{gather}
where $\mathbf{W} \in \mathbb{C}^{M_{r} \times 2M_r}$ is the codebook of vehicle, and $\mathbf{F} \in \mathbb{C}^{M_{t} \times 2M_t}$ is the codebook of BS. Each column vector of the codebook is codeword which represents a beam pattern, each entry in the column is phase rotation for corresponding antenna element to generate directional beam.

% 接收信号
At time step $n$, for transmitted signal $x_n$ from the BS, received signal $y_n$ at the vehicle is given by:
\begin{equation}
    y_n = \mathbf{w}^H_n \mathbf{H}_n \mathbf{f}_n x_n + \mathbf{w}^H_n \mathbf{v}_n
    \label{rs}
\end{equation}
where $\mathbf{w}_n$ and $\mathbf{f}_n$ are combining and beamforming vector, which are the codeword in $\mathbf{W}$ and $\mathbf{F}$, respectively.
$\mathbf{v}_n$ is Gaussian noise and $\mathbf{v}_n \sim \mathcal{CN}(0, \sigma^2_v \mathbf{I}_{M_r})$. 

\begin{figure*}[ht]
    \centerline{\includegraphics[scale=1]{procedure.pdf}}
    \caption{Procedure of FC-BET scheme}
    \label{procedure}
\end{figure*}

\section{Fast Consecutive Beam Tracking Scheme}\label{LBTS}

% 网络
\subsection{The LSTM Network}

% 问题定义
The purpose of beam tracking is to obtain optimal beam angles with as few beam measurements as possible for reducing the overhead brought by beam training.
Since the vehicle must travel in a particular direction on the road and the mmWave beams are correlated with the position of vehicles \cite{Aviles2016, Wang2019}, the problem of beam tracking can be formulated as a time series regression problem.

\begin{figure}[!b]
    \centerline{\input{lstm}}
    \caption{Structure of network}
    \label{lstm}
\end{figure}

% 结构
An artificial neural network based on LSTM is used to solve this regression problem.
LSTM has been implemented successfully in several fields such as machine translation, image captioning, speech recognition, and even stock prices prediction in economy.
It is powerful for handling time series data and learning long-term relations between features, relying on three gates, i.e. forget, input and output gates composed of neural networks (NNs) in LSTM cells.

Fig.~\ref{lstm} shows the structure of the network, which is a sequential model comprises two LSTM layers with 50 hidden units, two dropout layers with 0.2 probability and a fully connected layer with 2 nodes.
The output of the first LSTM layer is a sequence of length $n_L$, which is used as the input of the second LSTM layer.
And two dropout layers are set to prevent overfitting. 

% 损失函数？
\subsection{Loss Function}

Mean Square Error (MSE) is the most commonly used regression loss function for quantifying the error of prediction.
In \cite{Burghal2019}, considering the problem of angle ambiguity due to the periodicity of the beam angle results in unnecessary loss for large difference of beam angle when used MSE, D. Burghal et al. proposed to use a shifted cosine function as the loss function. 
However, when using this loss function, the training process may be unstable due to the multiple global minima, and the responses may not converge in a reasonable interval.
Therefore, to avoid the problem of angle ambiguity, the AoAs and AoDs are converted to interval $(0, \pi]$ before training, considering the symmetry of the cosine function around $\pi$.

% \begin{figure}[!t]
%     \centering
%     \includegraphics[scale=0.59]{results_gain}
%     \caption{Heatmap of $|\mathbf{a}^{H}(16, \theta^e)\mathbf{a}(16, \theta^p)|$}
%     \label{results_gain}
% \end{figure}

% In addition, another problem is that the codewords whose beam angle near $0$ or $\pi$ have close gains at two different angles, resulting in unnecessary loss in some cases, as shown in Fig.~\ref{results_gain}.
% For instance, in the case of the codeword whose beam angle is $\pi$, there are same gains at $0$ and $\pi$. 
% The loss should be small, even zero, if estimated angle is $0$ and predicted angle is $\pi$, although the absolute difference of them is $\pi$.
% A straightforward idea is taking $1-|\mathbf{a}^{H}(M, \theta^e)\mathbf{a}(M, \theta^p)|$ as the loss.
% Calculating this loss, however, requires array response vectors of estimated and predicted angles at the corresponding time step, which will increase the computational cost when training network.

Besides, the loss introduced by angular error should be higher as the number of corresponding antennas gets bigger, because large number of antennas leads to a narrow beam.
And the narrower the beam, the greater the effect on performance when the beam deflects.
Hence, for the AoA and AoD errors, each is multiply by a weight which depends on the number of antennas to balance this effect.

A modified MSE is used as loss function, which is defined as:
\begin{equation}
    L(\bm{\phi}, \bm{\theta}, \mathbf{M}) = \frac{\sum_{i=1}^{N}\left[M_r(\phi^{p}_{i} - \phi^{e}_{i})^2 + M_t (\theta^{p}_{i} - \theta^{e}_{i})^2\right]}{N(M_r + M_t)}
    \label{lf}
\end{equation}
where $N$ is the number of training samples, $\phi ^{e}_{i}$, $\theta ^{e}_{i}$, $\phi ^{p}_{i}$, $\theta ^{p}_{i}$, are the estimated AoA, estimated AoD, predicted AoA, and predicted AoD, respectively, for training sample $i$.

% 预测过程
\subsection{Procedure of FC-BET Scheme}

Fig.~\ref{procedure} demonstrates the procedure of FC-BET scheme.
Before exploiting the LSTM network for beam tracking, processor at the BS demands to collect historical optimal AoAs and AoDs, which are estimated by the vehicle using exhaustive beam search, to build a dataset for training the LSTM network.
The dataset is consisted of time series AoAs and AoDs of the vehicle from initial access to disconnection.
During training, the network takes the AoAs and AoDs from time step $k - n_L$ to $k - 1$ as features and the AoA and AoD at time step $k$ as responses.

After the LSTM network has been trained, the vehicle takes exhaustive beam search in consecutive $n_L$ time steps to obtain initial estimated AoAs and AoDs at the beginning of a round of beam tracking. 
The network will take the initial estimated AoAs and AoDs to predict AoA and AoD at next time step. 
Then, the predicted AoA and AoD will be used to compose new feature with the last $n_L - 1$ AoAs and AoDs in last feature.

Once the predicted AoA and AoD are obtained, the codewords whose steering angle closest to the predicted beam angles will be taken as beamforming and combining vectors.
For every time step, signal-to-noise ratio (SNR) under current prediction will be calculated and compared with a threshold ${SNR}_T$.
The network will repeat to use predicted result to compose new features to predict AoA and AoD at next time step, when the calculated SNR is greater than ${SNR}_T$.
Otherwise, a new round of estimation and prediction will be executed.
% It makes more sense to take the SNR of received signal rather than the absolute difference between predicted and estimated angles as a threshold, because there is no way to obtain a precise beam angle for judgment until it is accurately measured or predicted.

\section{Dataset Built}\label{DG}

% 信道矩阵
\subsection{Channel Matrix}

\begin{figure}[!b]
    \centerline{\input{scene}}
    \caption{Scene of mmWave vehicular communications for dataset built}
    \label{scene}
\end{figure}

% 场景介绍
A road traffic simulation software named ``SUMO'' \cite{SUMO2018} is used to generate sequential information of the vehicle in the scenario mentioned in Section \ref{SM}, which including a BS and a vehicle traveling on the road as shown in Fig.~\ref{scene}.
The vehicle departs from $(0, 100)$ at first time step, and arrives $(100, 0)$ at final time step.
Note that the speed of vehicle is non-linear and it depends on the road conditions and behavior of the driver which is defined by SUMO.

% 几何信息
At $n$th time step, the generated vehicle sequential information is composed of position $(x_{rn}, y_{rn})$, speed $v_n$ and directional angle $\beta_n$ of the vehicle, where $v_n$ is used to determine maximum Doppler shift in \eqref{ssfg}, and $\beta_n$ is used to determine $\phi_{ln}$ and $\omega_{ln}$.

Once the position of the vehicle and the BS are obtained, $\theta_n$ and $\phi_n$ can be calculated by simple geometric methods as following:
\begin{equation}
    \begin{cases}
    \theta _{n} =\arg( \Gamma _{xn} +j\Gamma _{yn})\\
    \phi _{n} =\arg( -\Gamma _{xn} -j\Gamma _{yn}) -\beta _{n}
    \end{cases}
    \label{ba}
\end{equation}
where $\Gamma _{xn} =x_{rn} -x_{t}$, $\Gamma _{yn} =y_{rn} -y_{t} $, and $(x_{t}, y_{t})$ are coordinates of the BS. 
Furthermore, the signal transmission time $t_n = d_n / c$ can be determined, where the distance between the BS and the vehicle is $d_n = \sqrt{\Gamma_{xn}^2 + \Gamma_{yn}^2}$, and $c$ is the light speed.
Now the channel matrix at each time step can be obtained from \eqref{cm}, \eqref{ssfg}, \eqref{pl}, \eqref{arv} and \eqref{ba}.

% 波束角度
\subsection{Beam Search}

% 观察信号
The AoAs and AoDs measured from exhaustive beam search scheme is used to train the network, rather than using the generated channel data directly.
Assume $x_n = 1$ is sent as reference signal, the observation matrix comprises all measurement of exhaustive search can be given by:
\begin{equation}
    \mathbf{Y}_{n} =\mathbf{W}^{H}\mathbf{H}_{n}\mathbf{F} +\mathbf{V}_{n}
\end{equation}
where $\mathbf{V}_n \in \mathbb{C}^{2M_r \times 2M_t}$ is Gaussian noise matrix composed of independent identically distribution (i.i.d.) elements, which are the noise part of \eqref{rs}. $\mathbf{Y}_n \in \mathbb{C}^{2M_r \times 2M_t}$, $[\mathbf{Y}_n]_{i,j}$ is the received signal used $[\mathbf{W}]_{:,i}$ as combining vector and $[\mathbf{F}]_{:,j}$ as beamforming vector.

% 最优波束
For each time step, both of the vehicle and the BS use their codebook to perform exhaustive beam search to find the optimal beam pair.
The indexes of optimal beam pair can be obtained by solving an optimization problem as following:
\begin{equation}
    \begin{aligned}
        ( i_{n}^* ,j_{n}^*) =~&\underset{i_{n} ,j_{n}}{\operatorname{argmax}}\Vert [\mathbf{Y}_{n}]_{i_{n} ,j_{n}}\Vert _{2} \\
        s.t.~&i_{n} \in [ 1, 2M_r], \\
        &j_{n} \in [ 1, 2M_t]
    \end{aligned}
\end{equation}
A simple nested loop algorithm can be exploited to solve this problem. Then, at $n$th time step, the optimal combining vector $\mathbf{w}^{*}_{n}$ and the optimal beamforming vector $\mathbf{f}^{*}_{n}$ are $\mathbf{w}^{*}_{n}=[\mathbf{W}]_{:,i_{n}^*}$ and $\mathbf{f}^{*}_{n}=[\mathbf{F}]_{:,j_{n}^*}$, respectively. And the estimated AoA $\phi ^{e}_{n}$ and AoD $\theta ^{e}_{n}$ used for training are given by:
\begin{equation}
    \begin{cases}
        \phi ^{e}_{n} = \frac{i_{n}^* \pi}{2M_r}\\
        \theta ^{e}_{n} = \frac{j_{n}^* \pi}{2M_t}
    \end{cases}
\end{equation}
The advantage of training with radian instead of the codeword indexes is that it allows the proposed beam tracking scheme to be generalized under terminals with different antenna configuration and beamforming techniques, without additional computation and transmitted data.

% 数据平滑
Note that due to the limited resolution of the beam codebook and the noise received at the vehicle, there will be some errors for beam training, which are reflected in fluctuations of the estimated time series AoAs and AoDs.
To reduce the fluctuations, a first order Savitzky-Golay filter with frame length $51$ is used to smooth the estimated AoAs and AoDs for training the LSTM network better.

\section{Simulation Results}\label{SR}

In this section, performances of the proposed FC-BET scheme are presented by analyzing SNR of received signal, outage probability and number of measurements.
The outage probability for a simulation is given by:
\begin{equation}
    P_{o} =\frac{\sum ^{N}_{i=1}\mathbf{I}( {SNR}_{i} \leqslant {SNR}_{T})}{N}
\end{equation}
where ${SNR}_i$ is the SNR of received signal for the $i$th sample and $\mathbf{I}$ is an indicator function.

% 仿真参数
\begin{table}[!t]
    \renewcommand{\arraystretch}{1.3}
    \caption{Simulation Parameters}
    \label{t_SP}
    \centering
    \begin{tabular}{l c}
        \hline
        \bfseries Parameters & \bfseries Values\\
        \hline
        Carrier frequency $f_{c}$ & $28 \times 10^9$ Hz\\
        Coordinates of BS $(x_t, y_t)$ & $(80, 80)$\\
        Number of antenna elements for BS $M_t$ & $16$\\
        Number of antenna elements for vehicle $M_r$ & $4$\\
        Number of subpaths $L$ & $20$\\
        Expectation of BS RMS angular spread $\lambda_t$ & $10.2 \degree$\\
        Expectation of vehicle RMS angular spread $\lambda_r$ & $15.5 \degree$\\
        Path loss standard deviation $\sigma_p$ & $5.8$ dB\\
        Noise variance of received signal $\sigma_v^2$ & $-120$ dBW\\
        Threshold of SNR ${SNR}_T$ & $5$ dB\\
        Lookback of LSTM $n_L$ & $5$\\
        Optimizer of LSTM & Adam\\
        Training epochs & 400\\
        Learning rate & 0.05\\
        \hline
    \end{tabular}
\end{table}

In this paper, the sample period of channel is $20$ ms, which corresponds to the synchronization signal burst period in \cite{3gpp38213}, and there are total $1540$ samples for training and $1009$ samples for testing. 
Table \ref{t_SP} shows the common simulation parameters.
For each simulation, parameters default to the values in Table \ref{t_SP}, except for those mentioned specifically.

% 收敛性能
\begin{figure}[!b]
    \centering
    \subfigure[RMSE of the LSTM Network]{
        \includegraphics[scale=0.65]{results_rmse}
        \label{results_rmse}
        }
    \subfigure[Loss of the LSTM Network]{
        \includegraphics[scale=0.65]{results_loss}
        \label{results_loss}
    }
    \caption{Convergence of the LSTM network}
    \label{results_convergence}
\end{figure}

Fig.~\ref{results_convergence} demonstrates the convergence of the LSTM network.
The root-mean-square error (RMSE) of the LSTM network is shown in Fig.~\ref{results_rmse}.
It is observed that the RMSE rapidly converges to about $0.4$ around $50$th epoch, and finally converges to about $0.2$ after $400$ epochs.
And the loss of the LSTM network is shown in Fig.~\ref{results_loss}.
It shows that the loss decreases sharply around $20$ epochs, and finally converges to a small value about $0.01$ after $400$ epochs.

% 16 * 4 天线，不同噪声方差下的平均 SNR，中断次数和观测次数
% 随着噪声方差增大，平均 SNR 降低，中断次数和观测次数增多。
\begin{figure}[!t]
    \centering
    \includegraphics[scale=0.54]{results_noise}
    \caption{Average SNR and outages probability versus $\sigma_v^2$}
    \label{results_noise}
\end{figure}
Fig.~\ref{results_noise} shows the performance of schemes versus $\sigma_v^2$.
It is observed that for both exhaustive and FC-BET scheme, the average SNR of received signal decreases and the probability of outages increases with the increase of $\sigma_v^2$.
The difference in the average SNR between FC-BET scheme and exhaustive scheme is small, up to about $8$ dB.
When $\sigma_v^2=-120$ dBW, there is not any outage in exhaustive scheme, and the average SNR of received signal in exhaustive scheme is $57.16$ dB compared with $52.53$ dB in FC-BET scheme, with a loss of only $4.63$ dB in SNR, indicating a loss of about $8.1\%$ in spectral efficiency.

\begin{table}[!b]
    \newcommand{\tabincell}[2]{\begin{tabular}{@{}#1@{}}#2\end{tabular}}
    \renewcommand{\arraystretch}{1.3}
    \centering
    \begin{threeparttable}
    \caption{\label{t_NM}Measurement Overhead Comparisons of Various Schemes}
        \begin{tabular}{c c c}
            \hline
            \bfseries Schemes & \bfseries Complexity & \bfseries Measurement Overhead\\
            \hline
            FC-BET & $N_s + n_L 4 N_f M_r M_t$\tnote{1} & $13799$\\
            Hierarchical & $2 N log_2{4 M_r M_t}$ & $16144$\\ % $N (2 (\log_2{2 M_t} - \log_2{2 M_r}) + 4 \log_2{2 M_r})$
            Exhaustive & $4 N M_r M_t$ & $258304$\\
            \hline
        \end{tabular}
        \begin{tablenotes}
            \item[1] $N_s$ is the number of successful prediction and $N_f = N - N_s$.
        \end{tablenotes}
    \end{threeparttable}
\end{table}

Table \ref{t_NM} shows the comparison of measurement overhead in different schemes.
The proposed FC-BET scheme reduces the measurement overhead by about $98.3\%$ and $14.5\%$ compared with exhaustive and hierarchical schemes, respectively.
Considering the significant reduction in measurement overhead, the $8.1\%$ loss of spectral efficiency in Fig.~\ref{results_noise} seems acceptable.
Note that FC-BET scheme performs initial estimation for prediction by exhaustive search approach in this paper, and it is obvious that the measurement overhead can be further reduced by utilizing a smarter beam search approach.

\begin{table}[!t]
    \renewcommand{\arraystretch}{1.3}
    \caption{Performance and Overhead Comparisons of Different $n_L$}
    \label{t_LBC}
    \centering
    \begin{tabular}{c | c c c c c}
        \hline
        \bfseries Lookback $n_L$ & 1 & 3 & 5 & 10\\
        \hline
        \bfseries Average SNR (dB) & 52.98 & 49.56 & \bfseries 53.74 & 50.91\\
        \hline
        \bfseries Outage probability & 0.032 & 0.020 & 0.010 & \bfseries 0.009\\
        \hline
        \bfseries Measurement Overhead & \bfseries 9169 & 16349 & 13799 & 24040\\
        \hline
    \end{tabular}
\end{table}
% https://medium.com/@iamvarman/how-to-calculate-the-number-of-parameters-in-the-cnn-5bd55364d7ca
% https://stackoverflow.com/questions/38080035/how-to-calculate-the-number-of-parameters-of-an-lstm-network
% LSTM: num_params = [(num_units + input_dim + 1) * num_units] * 4
% Dropout: 0 
% Fully connected: (input_dim + 1) * output_dim

In FC-BET scheme, $n_L$ determines the number of beam searches in initial estimation and the length of feature in LSTM network.
The comparisons of performance with different $n_L$ are shown in Table \ref{t_LBC}.
It is observed that with the increase of $n_L$, the outage probability decreases.
However, counterintuitively, it seems that the SNR is independent with $n_L$.
A reasonable guess is that larger $n_L$ reduce the outage probability but increase the uncertainty of predictions, which leads to fluctuations in SNR.
On the other hand, larger $n_L$ introduces longer initial estimation which may result in more measurements, therefore trade-off between performance and overhead should be considered.

\begin{figure}[!t]
    \centering
    \includegraphics[scale=0.54]{results_antenna}
    \caption{Average SNR and outages probability versus $M_t \times M_r$}
    \label{results_antenna}
\end{figure}

Fig.~\ref{results_antenna} shows that the difference of performance between FC-BET and exhaustive scheme increase with the number of antennas.
The reason is that the beam widths of the vehicle and the BS become smaller when the number of antennas become bigger, thus reducing tolerance for beam deflection.
It is noteworthy that the slow increase in outage probability implies that it is possible for FC-BET scheme to be applied in massive MIMO with further improvements.

\section{Conclusions}\label{C}

This paper studies the beam tracking problem in mmWave vehicular communications with ULA.
A fast consecutive beam tracking scheme based on LSTM, called FC-BET, is proposed to reduce the beam training overhead in a common vehicular scenario.
In order to evaluate the proposed scheme, a time series channel dataset is built by statistical channel model using sequential vehicle information generated from SUMO.
Simulation results have verified the FC-BET scheme can reduce the measurement overhead by $98.3\%$ and $14.5\%$ compared with the exhaustive and hierarchical schemes, respectively, with a loss of about $8.1\%$ in spectral efficiency.

\section*{Acknowledgment}

This work was supported in part by the China Postdoctoral Science Foundation under Grant 2019M650587, and in part by the National Natural Science Foundation of China under Grant 61801047.
% This work was supported in part by the National Natural Science Foundation of China (00000000), in part by the Beijing Key Laboratory of Network System Architecture and Convergence and in part by Beijing Laboratory of Advanced Information Networks.

\bibliographystyle{IEEEtran}
\bibliography{references}

\end{document}